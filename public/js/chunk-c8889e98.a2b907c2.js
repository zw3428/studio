(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c8889e98"],{"60e4":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("notifications"),n("img",{staticStyle:{width:"50%",position:"absolute",top:"0",left:"0"},attrs:{src:"/img/brand/tk_login_pic.png"}}),n("div",{staticClass:"container",staticStyle:{position:"relative","z-index":"1"}},[n("div",{staticClass:"row justify-content-center"},[n("div",{staticClass:"tk-bg-color-white tk-px-margin-top-px100 tk-text-center"},[2!==t.step?n("img",{staticClass:"tk-px-width-px90",attrs:{src:"/img/brand/tk_logo_icon.png"}}):n("avatar",{attrs:{uId:t.model.userId,studioId:t.model.studioId,name:t.model.fullName}}),n("fade-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:t.failed,expression:"failed"}],staticClass:"tk-font-color-orange tk-px-margin-top-px30 text-lg"},[n("span",{staticClass:"tk-opacity-0"},[t._v("0")]),n("span",{staticClass:"text-sm"},[t._v(t._s(t.failedMsg))]),n("span",{staticClass:"tk-opacity-0"},[t._v("0")])])]),n("fade-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.failed,expression:"!failed"}],staticClass:"tk-font-color-lightGray tk-px-margin-top-px30 text-lg"},[2!==t.step?n("span",[t._v("Get started")]):n("span",[t._v(t._s(t.model.fullName))])])])],1)]),n("div",{staticClass:"row justify-content-center"},[n("div",{staticClass:"col-lg-5 col-md-7 tk-px-margin-top-px30"},[n("validation-observer",{ref:"formValidator"},[n("form",{staticStyle:{width:"335px",margin:"0 auto"},attrs:{role:"form"}},[1===t.step?[n("base-input",{attrs:{alternative:"",name:"Email",rules:{required:!1,email:!0},"prepend-icon":"ni ni-email-83",placeholder:"Your email",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200",id:"loginAccount"},model:{value:t.model.email,callback:function(e){t.$set(t.model,"email",e)},expression:"model.email"}}),n("div",{staticClass:"text-center"},[n("button-with-loading",{staticStyle:{margin:"10px auto 1rem"},attrs:{text:"NEXT",width:"180",type:t.invalidEmail?"disable":"main",complete:t.isButtonLoadingComplete},on:{start:t.next}})],1),n("div",{staticClass:"text-center text-muted mb-4 tk-px-margin-top-px0"},[n("small",[t._v("or")]),n("div",{staticClass:"btn-wrapper text-center"},[n("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"20px auto",padding:"0"},on:{click:function(e){return e.preventDefault(),t.loginWithFacebook(e)}}},[n("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#3b5998","line-height":"50px",width:"50px",height:"50px"}},[n("i",{staticClass:"fab fa-facebook-f"})]),n("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[t._v("Log In with Facebook")])]),n("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"14px auto",padding:"0"},on:{click:function(e){return e.preventDefault(),t.loginWithGoogle(e)}}},[n("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#dc4e41","line-height":"50px",width:"50px",height:"50px"}},[n("i",{staticClass:"fab fa-google"})]),n("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[t._v("Log In with Google")])]),n("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"14px auto",padding:"0"},on:{click:function(e){return e.preventDefault(),t.loginWithApple(e)}}},[n("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#222","line-height":"50px",width:"50px",height:"50px"}},[n("i",{staticClass:"fab fa-apple"})]),n("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[t._v("Log In with Apple")])])])])]:t._e(),2===t.step?[n("base-input",{staticClass:"tk-form-input-pwd",attrs:{alternative:"",name:"Password",rules:{required:!1,min:6},"prepend-icon":"ni ni-lock-circle-open",type:"password",placeholder:"Password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.password,callback:function(e){t.$set(t.model,"password",e)},expression:"model.password"}}),n("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light tk-text-right",on:{click:function(e){return e.preventDefault(),t.forgotPwd(e)}}},[t._v(" Forgot password? ")]),n("div",{staticClass:"text-center"},[n("button-with-loading",{staticStyle:{margin:"30px auto 10px"},attrs:{text:"LOGIN",width:"180",type:t.invalidPwd?"disable":"main",complete:t.isButtonLoadingComplete},on:{start:t.login}}),n("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light",on:{click:function(e){return e.preventDefault(),t.notMe(e)}}},[t._v(" Not me? ")])],1)]:t._e(),3===t.step?[n("base-input",{attrs:{alternative:"",name:"Name","prepend-icon":"ni ni-single-02",placeholder:"Full name",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.fullName,callback:function(e){t.$set(t.model,"fullName",e)},expression:"model.fullName"}}),n("base-input",{attrs:{alternative:"",name:"Password","prepend-icon":"ni ni-lock-circle-open",rules:{required:!1,min:6,max:6},type:"password",placeholder:"Password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.password,callback:function(e){t.$set(t.model,"password",e)},expression:"model.password"}}),n("base-input",{staticClass:"tk-form-input-pwd",attrs:{alternative:"",name:"Password","prepend-icon":"ni ni-lock-circle-open",rules:{required:!1,min:6,max:6},type:"password",placeholder:"Confirm password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.password2,callback:function(e){t.$set(t.model,"password2",e)},expression:"model.password2"}}),t.passwordNotSame&&!t.invalidPwd2?n("div",{staticClass:"invalid-feedback",staticStyle:{display:"block"}},[t._v(" The two passwords are not the same ")]):t._e(),n("div",{staticClass:"text-center"},[n("button-with-loading",{staticStyle:{margin:"24px auto 1rem"},attrs:{text:"SIGN UP",width:"180",type:t.invalidPwd||t.invalidPwd2||""===t.model.fullName?"disable":"main",complete:t.isButtonLoadingComplete},on:{start:t.signup}}),n("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light",on:{click:function(e){return e.preventDefault(),t.notMe(e)}}},[t._v(" Already have an account? ")])],1)]:t._e()],2)])],1)])]),t.alert.isShow?n("alert",{attrs:{title:this.alert.title,content:this.alert.content,left:this.alert.buttons.left.title,right:this.alert.buttons.right.title},on:{onLeftTapped:this.alert.buttons.left.action,onRightTapped:this.alert.buttons.right.action}}):t._e()],1)},i=[],a=(n("5194"),n("82a8"),n("2a39"),n("96f8"),n("f923")),l=(n("6a61"),n("9ad1")),s=n("fdc1"),r=n("a336"),c=n.n(r),d=(n("f5ef"),n("41dc")),u=n("5e3a"),p={components:{avatar:function(){return Promise.resolve().then(n.bind(null,"7a12"))},buttonWithLoading:function(){return n.e("chunk-a8f506b8").then(n.bind(null,"6ea5"))},FadeTransition:d["b"],alert:function(){return n.e("chunk-2d0bdced").then(n.bind(null,"2e26"))}},data:function(){return{model:{fullName:"",email:"",password:"",password2:"",rememberMe:!1,userId:"",studioId:""},invalidEmail:!0,invalidPwd:!0,invalidPwd2:!0,email:"zw@gmail.com",step:1,passwordNotSame:!1,loading:!1,isButtonLoadingComplete:!1,failed:!1,failedMsg:"",alert:{isShow:!1,title:"",content:"",buttons:{left:{title:"",action:function(){}},right:{title:"",action:function(){}}}},marketerAccount:[],isMarketer:!1,account:""}},created:function(){this.getMarketer()},mounted:function(){console.log("进入login页面")},watch:{failed:function(t){var e=this;t&&setTimeout((function(){e.failed=!1,e.failedMsg=""}),1e3)},model:{handler:function(t,e){if(!this.loading){this.$tools.isEmail(t.email)?(console.log("输入的是email"),this.invalidEmail=!1):(this.invalidEmail=!0,0===c()("#loginAccount").find(".invalid-feedback").length&&(this.invalidEmail=!1));for(var n=0;n<this.marketerAccount.length;n++){if(this.marketerAccount[n].account===t.email){this.invalidEmail=!1,this.isMarketer=!0,this.account=t.email,setTimeout((function(){c()("#loginAccount").find(".invalid-feedback").hide()}),10);break}n==this.marketerAccount.length-1&&(this.isMarketer=!1,this.account="")}t.password.length>=6?this.invalidPwd=!1:this.invalidPwd=!0,t.password2.length>=6?(this.invalidPwd2=!1,t.password2===t.password?this.passwordNotSame=!1:this.passwordNotSame=!0):this.invalidPwd2=!0}},deep:!0}},methods:{getMarketer:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("获取 market 账号信息"),n=t,e.next=4,u["a"].config.doc("salesAccount").get().then((function(t){t.exists&&(n.marketerAccount=t.data().sales)}));case 4:case"end":return e.stop()}}),e)})))()},getUserInfo:function(){var t=this;return new Promise(function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(n,o){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$firebase.firestore().collection("user").where("loginMethod","array-contains-any",[{method:1,account:t.model.email},{method:2,account:t.model.email},{method:3,account:t.model.email},{method:4,account:t.model.email}]).get();case 3:i=e.sent,a=[],i.forEach((function(t){a.push(t.data())})),console.log("获取到的用户列表：",a),a.length>0?(console.log("返回第一个用户信息：",a[0]),n(a[0])):(console.log("用户信息为空"),n(null)),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),o(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())},getTeacherInfo:function(t){var e=this;return new Promise(function(){var n=Object(l["a"])(regeneratorRuntime.mark((function n(o,i){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$firebase.firestore().collection("teacher_info").doc(t).get();case 3:a=n.sent,console.log("获取到的教师信息: ",a),o(a.data()),n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),i(n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(t,e){return n.apply(this,arguments)}}())},next:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var n,o,i,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t,n.invalidEmail||n.loading){e.next=37;break}if(n.isMarketer){e.next=36;break}return n.loading=!0,e.next=6,n.getUserInfo();case 6:if(o=e.sent,console.log("获取到的用户信息：",o),null===o){e.next=25;break}if(!n.$tools.isTeacher(o.roleIds)){e.next=21;break}return e.next=12,n.getTeacherInfo(o.userId);case 12:i=e.sent,console.log("获取到的教师信息: ",i),n.isButtonLoadingComplete=!0,n.step=2,n.model.fullName=o.name,n.model.userId=o.userId,n.model.studioId=i.studioId,e.next=23;break;case 21:n.isButtonLoadingComplete=!0,console.log("当前身份是学生,退出登录");case 23:e.next=32;break;case 25:return console.log("校验email是否正确"),e.next=28,s["a"].emailValidVerify(n.model.email);case 28:l=e.sent,console.log("当前email合法性: ",l),console.log("当前校验结果类型: ",Object(a["a"])(l)),l?(console.log("当前email合法"),n.isButtonLoadingComplete=!0,n.step=3,n.model.fullName=""):(console.log("Email 不合法: ",n.model.email),n.alert.title="Wrong email",n.alert.content="This email address \n("+n.model.email+") \ndoesn't exist or temporatily couldn't receive message.",n.alert.buttons.left.title="Go Back",n.alert.buttons.left.action=function(){n.alert.isShow=!1,n.isButtonLoadingComplete=!0},n.alert.buttons.right.title="Continue",n.alert.buttons.right.action=function(){n.alert.title="Continue?",n.alert.content="Are you sure to continue with this wrong email address \n("+n.model.email+")?",n.alert.buttons.left.title="Go Back",n.alert.buttons.right.title="Continue",n.alert.buttons.right.action=function(){n.isButtonLoadingComplete=!0,n.step=3,n.model.fullName="",n.alert.isShow=!1},n.alert.isShow=!0},n.alert.isShow=!0);case 32:n.isButtonLoadingComplete=!1,n.loading=!1,e.next=37;break;case 36:n.$router.push({name:"AdministrationLogin",query:{account:n.account}});case 37:case"end":return e.stop()}}),e)})))()},notMe:function(){var t=this;t.model.fullName="",t.model.password="",t.model.password2="",t.invalidPwd=!0,t.invalidPwd2=!0,t.step=1},forgotPwd:function(){},login:function(){var t=this;console.log(t.model),t.$tools.isNull(t.model.email)||(t.loading=!0,t.$firebase.auth().signInWithEmailAndPassword(t.model.email,t.model.password).then((function(e){console.log("登陆成功：",e),t.loading=!1,t.isButtonLoadingComplete=!0})).catch((function(e){console.error("登陆失败：",e),t.isButtonLoadingComplete=!1}))),t.isButtonLoadingComplete=!1,t.loading=!1},loginWithFacebook:function(){console.log("ready to sign in with Facebook");var t=this;if(!t.loading){var e=t.$firebase,n=new e.auth.FacebookAuthProvider;t.signIn(n)}},loginWithGoogle:function(){console.log("ready to sign in with Google");var t=this;if(!t.loading){var e=t.$firebase,n=new e.auth.GoogleAuthProvider;t.signIn(n)}},loginWithApple:function(){console.log("ready to sign in with Apple");var t=this;if(!t.loading){var e=t.$firebase,n=new e.auth.OAuthProvider("apple.com");n.addScope("email"),n.addScope("name"),t.signIn(n)}},signIn:function(t){var e=this,n=e.$firebase;n.auth().signInWithPopup(t).then((function(t){console.log("login success");var e=t.credential.accessToken;localStorage.setItem("auth_token",e);var n=t.user;localStorage.setItem("auth_user",n)})).catch((function(t){console.error("login failed:",t)}))},signup:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var n,o,i,a,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t,n.$tools.isNull(n.model.fullName)||n.$tools.isNull(n.model.password)||n.$tools.isNull(n.model.password2)||n.loading){e.next=16;break}return console.log("点击注册"),e.next=5,s["a"].emailValidVerify(t.model.email);case 5:return o=e.sent,o||t.$notify({message:"The email is wrong",type:"warning"}),console.log("校验结果: ",o),n.loading=!0,i=n.$firebase,a=i.functions().httpsCallable("teacherSignup"),e.next=13,a({email:n.model.email,password:n.model.password,fullName:n.model.fullName});case 13:l=e.sent,console.log("获取到的注册结果: ",l),l.data?0===l.data.code?t.login():console.log("sign up failed: ",l):console.error("sign up failed: ",l);case 16:case"end":return e.stop()}}),e)})))()}}},m=p,g=n("5d22"),h=Object(g["a"])(m,o,i,!1,null,null,null);e["default"]=h.exports},f923:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));n("6b07"),n("cf2b"),n("08b3"),n("2a39"),n("f39f"),n("4021");function o(t){return o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}}}]);
//# sourceMappingURL=chunk-c8889e98.a2b907c2.js.map