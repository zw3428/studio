(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a3d38636"],{"3e83":function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));n("2522"),n("de78"),n("6019"),n("c585"),n("a0ef"),n("281b");function o(t){return o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}},"60e4":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("notifications"),n("img",{staticStyle:{width:"50%",position:"absolute",top:"0",left:"0"},attrs:{src:"/img/brand/tk_login_pic.png"}}),n("div",{staticClass:"container",staticStyle:{position:"relative","z-index":"1"}},[n("div",{staticClass:"row justify-content-center"},[n("div",{staticClass:"tk-bg-color-white tk-px-margin-top-px100 tk-text-center"},[2!==t.step?n("img",{staticClass:"tk-px-width-px90",attrs:{src:"/img/brand/tk_logo_icon.png"}}):n("avatar",{attrs:{uId:t.model.userId,studioId:t.model.studioId,name:t.model.fullName}}),n("fade-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:t.failed,expression:"failed"}],staticClass:"tk-font-color-orange tk-px-margin-top-px30 text-lg"},[n("span",{staticClass:"tk-opacity-0"},[t._v("0")]),n("span",{staticClass:"text-sm"},[t._v(t._s(t.failedMsg))]),n("span",{staticClass:"tk-opacity-0"},[t._v("0")])])]),n("fade-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.failed,expression:"!failed"}],staticClass:"tk-font-color-lightGray tk-px-margin-top-px30 text-lg"},[2!==t.step?n("span",[t._v("Get started")]):n("span",[t._v(t._s(t.model.fullName))])])])],1)]),n("div",{staticClass:"row justify-content-center"},[n("div",{staticClass:"col-lg-5 col-md-7 tk-px-margin-top-px30"},[n("validation-observer",{ref:"formValidator"},[n("form",{staticStyle:{width:"335px",margin:"0 auto"},attrs:{role:"form"}},[1===t.step?[n("base-input",{attrs:{alternative:"",name:"Email",rules:{required:!1,email:!0},"prepend-icon":"ni ni-email-83",placeholder:"Your email",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200",id:"loginAccount"},model:{value:t.model.email,callback:function(e){t.$set(t.model,"email",e)},expression:"model.email"}}),n("div",{staticClass:"text-center"},[n("button-with-loading",{staticStyle:{margin:"10px auto 1rem"},attrs:{text:"NEXT",width:"180",type:t.invalidEmail?"disable":"main",complete:t.isButtonLoadingComplete},on:{start:t.next}})],1),n("div",{staticClass:"text-center text-muted mb-4 tk-px-margin-top-px0"},[n("small",[t._v("or")]),n("div",{staticClass:"btn-wrapper text-center"},[n("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"20px auto",padding:"0"},on:{click:function(e){return e.preventDefault(),t.loginWithFacebook(e)}}},[n("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#3b5998","line-height":"50px",width:"50px",height:"50px"}},[n("i",{staticClass:"fab fa-facebook-f"})]),n("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[t._v("Log In with Facebook")])]),n("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"14px auto",padding:"0"},on:{click:function(e){return e.preventDefault(),t.loginWithGoogle(e)}}},[n("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#dc4e41","line-height":"50px",width:"50px",height:"50px"}},[n("i",{staticClass:"fab fa-google"})]),n("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[t._v("Log In with Google")])]),n("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"14px auto",padding:"0"},on:{click:function(e){return e.preventDefault(),t.loginWithApple(e)}}},[n("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#222","line-height":"50px",width:"50px",height:"50px"}},[n("i",{staticClass:"fab fa-apple"})]),n("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[t._v("Log In with Apple")])])])])]:t._e(),2===t.step?[n("base-input",{staticClass:"tk-form-input-pwd",attrs:{alternative:"",name:"Password",rules:{required:!1,min:6,max:6},"prepend-icon":"ni ni-lock-circle-open",type:"password",placeholder:"Password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.password,callback:function(e){t.$set(t.model,"password",e)},expression:"model.password"}}),n("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light tk-text-right",on:{click:function(e){return e.preventDefault(),t.forgotPwd(e)}}},[t._v(" Forgot password? ")]),n("div",{staticClass:"text-center"},[n("button-with-loading",{staticStyle:{margin:"30px auto 10px"},attrs:{text:"LOGIN",width:"180",type:t.invalidPwd?"disable":"main",complete:t.isButtonLoadingComplete},on:{click:t.login}}),n("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light",on:{click:function(e){return e.preventDefault(),t.notMe(e)}}},[t._v(" Not me? ")])],1)]:t._e(),3===t.step?[n("base-input",{attrs:{alternative:"",name:"Name","prepend-icon":"ni ni-single-02",placeholder:"Full name",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.fullName,callback:function(e){t.$set(t.model,"fullName",e)},expression:"model.fullName"}}),n("base-input",{attrs:{alternative:"",name:"Password","prepend-icon":"ni ni-lock-circle-open",rules:{required:!1,min:6,max:6},type:"password",placeholder:"Password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.password,callback:function(e){t.$set(t.model,"password",e)},expression:"model.password"}}),n("base-input",{staticClass:"tk-form-input-pwd",attrs:{alternative:"",name:"Password","prepend-icon":"ni ni-lock-circle-open",rules:{required:!1,min:6,max:6},type:"password",placeholder:"Confirm password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.password2,callback:function(e){t.$set(t.model,"password2",e)},expression:"model.password2"}}),t.passwordNotSame&&!t.invalidPwd2?n("div",{staticClass:"invalid-feedback",staticStyle:{display:"block"}},[t._v(" The two passwords are not the same ")]):t._e(),n("div",{staticClass:"text-center"},[n("button-with-loading",{staticStyle:{margin:"10px auto 1rem"},attrs:{text:"SIGN UP",width:"180",type:t.invalidPwd||t.invalidPwd2||""===t.model.fullName?"disable":"main",complete:t.isButtonLoadingComplete},on:{click:t.signup}}),n("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light",on:{click:function(e){return e.preventDefault(),t.notMe(e)}}},[t._v(" Already have an account? ")])],1)]:t._e()],2)])],1)])]),t.alert.isShow?n("alert",{attrs:{title:this.alert.title,content:this.alert.content,left:this.alert.buttons.left.title,right:this.alert.buttons.right.title},on:{onLeftTapped:this.alert.buttons.left.action,onRightTapped:this.alert.buttons.right.action}}):t._e()],1)},i=[],a=(n("9f1b"),n("3610"),n("eb5b"),n("c585"),n("f644"),n("3e83")),s=(n("6a61"),n("2e91")),l=n("7a12"),r=n("fdc1"),c=n("a336"),d=n.n(c),p=(n("f5ef"),n("6ea5")),u=(n("7bca"),n("41dc")),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("modal",{attrs:{show:t.show},on:{"update:show":function(e){t.show=e},close:t.close}},[n("template",{slot:"header"},[n("h5",{staticClass:"modal-title"},[t._v(t._s(t.title))])]),n("div",{staticClass:"tk-popup-content"},[t._v(" "+t._s(t.content)+" ")]),n("template",{slot:"footer"},[""!==t.left?n("base-button",{staticClass:"tk-font-color-lightGray tk-border-none",attrs:{type:t.leftType},on:{click:function(e){return e.preventDefault(),t.onLeftTapped(e)}}},[t._v(t._s(t.left))]):t._e(),""!==t.center?n("base-button",{staticClass:"tk-font-color-white tk-bg-color-red tk-border-none",attrs:{type:t.centerType},on:{click:function(e){return e.preventDefault(),t.onCenterTapped(e)}}},[t._v(t._s(t.center))]):t._e(),""!==t.right?n("base-button",{staticClass:"tk-font-color-white tk-bg-color-red tk-border-none",attrs:{type:t.rightType},on:{click:function(e){return e.preventDefault(),t.onRightTapped(e)}}},[t._v(t._s(t.right))]):t._e()],1)],2)},f=[],g={props:{title:String,content:String,left:{type:String,default:""},center:{type:String,default:""},right:{type:String,default:""},leftType:{type:String,default:"secondary"},centerType:{type:String,default:"secondary"},rightType:{type:String,default:"primary"}},data:function(){return{show:!1}},mounted:function(){var t=this;t.init()},methods:{close:function(){this.$emit("close"),this.modalClose()},onLeftTapped:function(){this.$emit("onLeftTapped"),this.modalClose()},onCenterTapped:function(){this.$emit("onCenterTapped"),this.modalClose()},onRightTapped:function(){this.$emit("onRightTapped"),this.modalClose()},modalClose:function(){document.getElementsByTagName("body")[0].classList.remove("modal-open")},init:function(){var t=this;setTimeout((function(){t.show=!0}),200)}}},h=g,b=n("c701"),w=Object(b["a"])(h,m,f,!1,null,null,null),k=w.exports,v={components:{avatar:l["a"],buttonWithLoading:p["a"],FadeTransition:u["b"],alert:k},data:function(){return{model:{fullName:"",email:"",password:"",password2:"",rememberMe:!1,userId:"",studioId:""},invalidEmail:!0,invalidPwd:!0,invalidPwd2:!0,email:"zw@gmail.com",step:1,passwordNotSame:!1,loading:!1,isButtonLoadingComplete:!1,failed:!1,failedMsg:"",alert:{isShow:!1,title:"",content:"",buttons:{left:{title:"",action:function(){}},right:{title:"",action:function(){}}}}}},mounted:function(){console.log("进入login页面")},computed:{getAllowedSignin:function(){return this.$store.state.isAllowedSignin}},watch:{failed:function(t){var e=this;t&&setTimeout((function(){e.failed=!1,e.failedMsg=""}),1e3)},getAllowedSignin:function(t,e){},model:{handler:function(t,e){this.loading||(this.$tools.isEmail(t.email)?(console.log("输入的是email"),this.invalidEmail=!1):(this.invalidEmail=!0,0===d()("#loginAccount").find(".invalid-feedback").length&&(this.invalidEmail=!1)),6===t.password.length?this.invalidPwd=!1:this.invalidPwd=!0,6===t.password2.length?(this.invalidPwd2=!1,t.password2===t.password?this.passwordNotSame=!1:this.passwordNotSame=!0):this.invalidPwd2=!0)},deep:!0}},methods:{getUserInfo:function(){var t=this;return new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n,o){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$firebase.firestore().collection("user").where("loginMethod","array-contains-any",[{method:1,account:t.model.email},{method:2,account:t.model.email},{method:3,account:t.model.email},{method:4,account:t.model.email}]).get();case 3:i=e.sent,a=[],i.forEach((function(t){a.push(t.data())})),console.log("获取到的用户列表：",a),a.length>0?(console.log("返回第一个用户信息：",a[0]),n(a[0])):(console.log("用户信息为空"),n(null)),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),o(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())},getTeacherInfo:function(t){var e=this;return new Promise(function(){var n=Object(s["a"])(regeneratorRuntime.mark((function n(o,i){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$firebase.firestore().collection("teacher_info").doc(t).get();case 3:a=n.sent,console.log("获取到的教师信息: ",a),o(a.data()),n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),i(n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(t,e){return n.apply(this,arguments)}}())},next:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,o,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t,n.invalidEmail||n.loading){e.next=32;break}return n.loading=!0,e.next=5,n.getUserInfo();case 5:if(o=e.sent,console.log("获取到的用户信息：",o),null===o){e.next=24;break}if(!n.$tools.isTeacher(o.roleIds)){e.next=20;break}return e.next=11,n.getTeacherInfo(o.userId);case 11:i=e.sent,console.log("获取到的教师信息: ",i),n.isButtonLoadingComplete=!0,n.step=2,n.model.fullName=o.name,n.model.userId=o.userId,n.model.studioId=i.studioId,e.next=22;break;case 20:n.isButtonLoadingComplete=!0,console.log("当前身份是学生,退出登录");case 22:e.next=31;break;case 24:return console.log("校验email是否正确"),e.next=27,r["a"].emailValidVerify(n.model.email);case 27:s=e.sent,console.log("当前email合法性: ",s),console.log("当前校验结果类型: ",Object(a["a"])(s)),s?(console.log("当前email合法"),n.isButtonLoadingComplete=!0,n.step=3,n.model.fullName=""):(console.log("Email 不合法: ",n.model.email),n.alert.title="Wrong email",n.alert.content="This email address \n("+n.model.email+") \ndoesn't exist or temporatily couldn't receive message.",n.alert.buttons.left.title="Go Back",n.alert.buttons.left.action=function(){n.alert.isShow=!1,n.isButtonLoadingComplete=!0},n.alert.buttons.right.title="Continue",n.alert.buttons.right.action=function(){n.alert.title="Continue?",n.alert.content="Are you sure to continue with this wrong email address \n("+n.model.email+")?",n.alert.buttons.left.title="Go Back",n.alert.buttons.right.title="Continue",n.alert.buttons.right.action=function(){n.isButtonLoadingComplete=!0,n.step=3,n.model.fullName="",n.alert.isShow=!1},n.alert.isShow=!0},n.alert.isShow=!0);case 31:n.isButtonLoadingComplete=!1;case 32:case"end":return e.stop()}}),e)})))()},notMe:function(){var t=this;t.model.fullName="",t.model.password="",t.model.password2="",t.invalidPwd=!0,t.invalidPwd2=!0,t.step=1},forgotPwd:function(){},login:function(){var t=this;t.$tools.isNull(t.model.email)||(t.loading=!0,t.$firebase.auth().signInWithEmailAndPassword(t.model.email,t.model.password).then((function(e){console.log("登陆成功：",e),t.loading=!1,t.isButtonLoadingComplete=!0})).catch((function(e){console.error("登陆失败：",e),t.isButtonLoadingComplete=!1}))),t.isButtonLoadingComplete=!1},loginWithFacebook:function(){console.log("ready to sign in with Facebook");var t=this;if(!t.loading){var e=t.$firebase,n=new e.auth.FacebookAuthProvider;t.signIn(n)}},loginWithGoogle:function(){console.log("ready to sign in with Google");var t=this;if(!t.loading){var e=t.$firebase,n=new e.auth.GoogleAuthProvider;t.signIn(n)}},loginWithApple:function(){console.log("ready to sign in with Apple");var t=this;if(!t.loading){var e=t.$firebase,n=new e.auth.OAuthProvider("apple.com");n.addScope("email"),n.addScope("name"),t.signIn(n)}},signIn:function(t){var e=this,n=e.$firebase;n.auth().signInWithPopup(t).then((function(t){console.log("login success");var e=t.credential.accessToken;localStorage.setItem("auth_token",e);var n=t.user;localStorage.setItem("auth_user",n)})).catch((function(t){console.error("login failed:",t)}))},signup:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,o,i,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t,n.$tools.isNull(n.model.fullName)||n.$tools.isNull(n.model.password)||n.$tools.isNull(n.model.password2)||n.loading){e.next=16;break}return console.log("点击注册"),e.next=5,r["a"].emailValidVerify(t.model.email);case 5:return o=e.sent,o||t.$notify({message:"The email is wrong",type:"warning"}),console.log("校验结果: ",o),n.loading=!0,i=n.$firebase,a=i.functions().httpsCallable("teacherSignup"),e.next=13,a({email:n.model.email,password:n.model.password,fullName:n.model.fullName});case 13:s=e.sent,console.log("获取到的注册结果: ",s),s.data?0===s.data.code?t.login():console.log("sign up failed: ",s):console.error("sign up failed: ",s);case 16:case"end":return e.stop()}}),e)})))()}}},x=v,y=Object(b["a"])(x,o,i,!1,null,null,null);e["default"]=y.exports},"6ea5":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tk-position-relative text-center",staticStyle:{width:"fit-content",margin:"0 auto"}},[n("div",{staticClass:"btn base-button tk-button tk-px-margin-right-px0 text-center",staticStyle:{opacity:"0","box-shadow":"none"},style:{width:""===t.width?"fit-content":t.width+"px"}},[n("span",[t._v(t._s(t.text))])]),n("svg",{ref:"loading",staticStyle:{width:"80px",height:"80px",position:"absolute",transform:"translate(-50%, -50%)",left:"50%",top:"50%",display:"none"},attrs:{id:"loading",version:"1.1",x:"0px",y:"0px",viewBox:"0 0 100 100","enable-background":"new 0 0 0 0","xml:space":"preserve"}},[n("path",{attrs:{fill:"#71d9c2",d:"M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50",transform:"rotate(188.223 50 50)"}},[n("animateTransform",{attrs:{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"}})],1)]),n("div",{ref:"tkButton",staticClass:"btn base-button tk-button tk-px-margin-right-px0 tk-position-absolute text-center",class:{"tk-bg-color-main":"main"===t.type,"tk-bg-color-gray-200":"disable"===t.type,"tk-font-color-white":"disable"!==t.type,"tk-font-color-gray":"disable"===t.type},staticStyle:{left:"50%",top:"50%",transform:"translate(-50%, -50%)","white-space":"nowrap"},style:{width:""===t.width?"fit-content":t.width+"px"},attrs:{id:"tkButton"},on:{click:t.handleClick}},[n("span",{ref:"tkButtonText",attrs:{id:"tkButtonText"}},[t._v(t._s(t.text))])])])},i=[],a=n("a336"),s=n.n(a),l={name:"button-with-loading",props:{text:{type:String,default:"Button",description:"按钮文本"},type:{default:"main",description:"按钮类型： main(可点击), disable(不可点击)"},complete:{type:Boolean,default:!1,description:"是否完成请求"},width:{type:String,description:"自定义宽度，默认 fit-content"}},data:function(){return{}},watch:{complete:function(t){t&&this.stopLoading()}},methods:{handleClick:function(t){var e=this,n=e.$refs.tkButtonText,o=e.$refs.tkButton,i=e.$refs.loading;"disable"!==e.type&&(s()(n).stop().animate({opacity:0},100),s()(o).stop().animate({width:"40px",borderRadius:"40px"},200,(function(){s()(o).stop().fadeOut(),s()(i).stop().fadeIn(),e.$emit("start")})))},stopLoading:function(){var t=this,e=t.$refs.tkButtonText,n=t.$refs.tkButton,o=t.$refs.loading;s()(o).stop().fadeOut("normal"),s()(n).stop().fadeIn("normal",(function(){s()(n).animate({width:"100%",borderRadius:"0.25rem"},200,(function(){s()(e).stop().animate({opacity:1},100,(function(){t.$emit("end")}))}))}))}}},r=l,c=(n("ed49"),n("c701")),d=Object(c["a"])(r,o,i,!1,null,"b3ca177e",null);e["a"]=d.exports},bb2e:function(t,e,n){},ed49:function(t,e,n){"use strict";n("bb2e")}}]);
//# sourceMappingURL=chunk-a3d38636.03d267e7.js.map