(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1804281e"],{"06cb":function(e,t,n){"use strict";t.__esModule=!0;var a=n("a593"),s=i(a),o=n("c865");function i(e){return e&&e.__esModule?e:{default:e}}var l=[],c="@@clickoutsideContext",r=void 0,d=0;function u(e,t,n){return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!(n&&n.context&&a.target&&s.target)||e.contains(a.target)||e.contains(s.target)||e===a.target||n.context.popperElm&&(n.context.popperElm.contains(a.target)||n.context.popperElm.contains(s.target))||(t.expression&&e[c].methodName&&n.context[e[c].methodName]?n.context[e[c].methodName]():e[c].bindingFn&&e[c].bindingFn())}}!s.default.prototype.$isServer&&(0,o.on)(document,"mousedown",(function(e){return r=e})),!s.default.prototype.$isServer&&(0,o.on)(document,"mouseup",(function(e){l.forEach((function(t){return t[c].documentHandler(e,r)}))})),t.default={bind:function(e,t,n){l.push(e);var a=d++;e[c]={id:a,documentHandler:u(e,t,n),methodName:t.expression,bindingFn:t.value}},update:function(e,t,n){e[c].documentHandler=u(e,t,n),e[c].methodName=t.expression,e[c].bindingFn=t.value},unbind:function(e){for(var t=l.length,n=0;n<t;n++)if(l[n][c].id===e[c].id){l.splice(n,1);break}delete e[c]}}},"5e3a":function(e,t,n){"use strict";var a=n("1543");function s(e){return a["a"].firestore().collection(e)}t["a"]={user:s("user"),userOnline:s("user_online"),userUnreadCount:s("user_unread_count"),instrument:s("instrument"),teacher:s("teacher_info"),teacherStudentList:s("students_list"),policies:s("policy"),lessonType:s("lesson_type"),studio:s("studio_info"),cache:s("cache"),makeupPolicy:s("makeup_policy"),cancellationPolicy:s("cancellation_policy"),lessonSchedule:s("lesson_schedule"),lessonReschedule:s("lesson_reschedule"),lessonSchedulePlan:s("lesson_schedule_plan"),lessonScheduleMaterial:s("lesson_schedule_material"),lessonScheduleAssignment:s("lesson_schedule_assignment"),practice:s("practice"),achievement:s("achievement"),material:s("material"),materialHash:s("material_hash"),materialAccessControl:s("material_access_control"),student:s("student_info"),lessonScheduleConfigure:s("lesson_schedule_config"),eventConfig:s("event_config"),block:s("block"),userNotificationConfig:s("user_notification_config"),insightsCount:s("insights_count"),rescheduleMakeupRefund:s("student_reschedule_makeup_refund_history"),lessonCancellation:s("lesson_cancellation"),allowSwapStatistics:s("allow_swap_statistics"),calendarLinkSetting:s("calendar_link_setting"),googleCalendarEvents:s("google_calendar_events"),googleCalendarEventsWatch:s("google_calendar_events_watch"),userNotifications:s("user_notifications"),bugReports:s("bug_reports"),teacherReschedules:s("teacher_reschedules"),errors:s("tk_errors"),couponHistory:s("promo_codes_history"),userReceipt:s("user_receipt"),accessTokenGoogle:s("access_token_google"),appSessions:s("app_sessions"),appSessionActions:s("app_sessions_actions"),appEvents:s("app_events"),config:s("config"),googleEmail:s("google_email"),googleAccessTokenCalendar:s("google_access_token_calendar"),googleAccessTokenDrive:s("google_access_token_drive"),googleAccessTokenPhotos:s("google_access_token_photos"),googleCalendarEventsSyncToken:s("google_calendar_events_sync_token"),teacherPermissions:s("teacher_permissions"),salesMan:s("sales_man"),salesManParams:s("sales_man_params"),salesManRecords:s("sales_man_records"),salesManLinks:s("sales_man_links"),signUpViaLinkCount:s("signup_via_link_count")}},6873:function(e,t,n){},"6b11":function(e,t,n){"use strict";n("78e0")},"78e0":function(e,t,n){},e97a:function(e,t,n){"use strict";n.r(t);var a,s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("notifications"),n("base-header",{staticClass:"pb-6"},[n("div",{staticClass:"row align-items-center py-4"},[n("div",{staticClass:"col-lg-6 col-7"},[n("h6",{staticClass:"h2 text-white d-inline-block mb-0"},[e._v(" TuneKey Dynamic Link ")])]),n("div",{staticClass:"col-lg-6 col-5 text-right"},[n("base-button",{attrs:{size:"sm",type:"neutral"},on:{click:function(t){return t.preventDefault(),e.logout(t)}}},[e._v("Logout")])],1)])]),n("div",{staticClass:"container-fluid mt--6"},[n("div",{staticClass:"card mb-4"},[n("div",{staticClass:"card-header"},[n("div",{staticClass:"row align-items-center"},[e._m(0),n("div",{staticClass:"col-4 text-right"},[n("span",{staticClass:"btn btn-sm btn-neutral tk-font-color-main",on:{click:function(t){t.preventDefault(),e.showModal=!0}}},[e._v("New Link")])])])]),n("div",{staticClass:"card-body",staticStyle:{"min-height":"400px"}},[e.isLoading?n("card-loading"):[n("spread-dynamic-link-inline-action-table",{attrs:{salesManParams:e.salesManParams}})]],2)])]),n("modal",{attrs:{show:e.showModal},on:{"update:show":function(t){e.showModal=t}}},[n("template",{slot:"header"},[n("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[e._v("New Link")])]),n("div",{staticClass:"tk-popup-content",staticStyle:{"max-height":"60vh","overflow-y":"auto"}},[n("div",[n("span",[n("div",{staticClass:"form-group"},[n("label",{staticClass:"form-control-label"},[e._v("Name")]),n("div",{staticClass:"has-label"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"form-control form-control-muted tk-border-bottom tk-font-color-black1",attrs:{type:"text"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})])])]),n("div",[n("span",[n("div",{staticClass:"form-group"},[n("label",{staticClass:"form-control-label"},[e._v("Email")]),n("div",{staticClass:"has-label"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"form-control form-control-muted tk-border-bottom tk-font-color-black1",class:{"is-invalid":e.isInvalid},attrs:{type:"email"},domProps:{value:e.email},on:{blur:function(t){return t.preventDefault(),e.validationEmail(t)},input:function(t){t.target.composing||(e.email=t.target.value)}}})]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isInvalid,expression:"isInvalid"}],staticClass:"invalid-feedback",staticStyle:{display:"block"}},[e._v(" The email is not correct. ")])])])]),n("span",[n("div",{staticClass:"form-group tk-px-margin-bottom-px0"},[n("label",{staticClass:"form-control-label"},[e._v("Free months")]),n("div",{staticClass:"has-label"},[n("el-select",{staticClass:"tk-select-border-none tk-border-bottom tk-select-bg-mute",model:{value:e.months.selected,callback:function(t){e.$set(e.months,"selected",t)},expression:"months.selected"}},e._l(e.months.options,(function(e,t){return n("el-option",{key:t,attrs:{label:e>0?e+"-MONTH-FREE":"FREE DOWNLOAD",value:e}})})),1)],1)])]),n("img",{staticStyle:{width:"calc(100% - 4rem)",display:"block",margin:"0 auto"},attrs:{src:"/img/coupon/coupon-"+e.months.selected+".png"}}),n("span",[n("div",{staticClass:"form-group card-wrapper tk-px-margin-bottom-px0"},[n("div",{staticClass:"card tk-px-margin-bottom-px16"},[n("div",{staticClass:"form-control",staticStyle:{height:"auto"}},[n("span",{staticClass:"tk-layout-inline-block tk-font-color-black1",staticStyle:{width:"calc(100% - 56px)"}},[e.expirationOpen?[n("span",[e._v("Expiration date")]),n("flat-picker",{staticClass:"form-control form-control-muted tk-bg-color-gray-100 datepicker tk-layout-inline-block tk-px-width-px100 tk-px-margin-left-px10 tk-px-height-px36",attrs:{config:{allowInput:!0}},model:{value:e.expiration,callback:function(t){e.expiration=t},expression:"expiration"}})]:n("span",[e._v("Expiration")])],2),n("base-switch",{staticClass:"mr-1 tk-layout-inline-block",attrs:{"on-text":"On","off-text":"Off",type:"main"},model:{value:e.expirationOpen,callback:function(t){e.expirationOpen=t},expression:"expirationOpen"}})],1)])])])])]),n("template",{slot:"footer"},[n("base-button",{staticClass:"tk-font-color-lightGray tk-border-none",attrs:{type:"secondary"},on:{click:function(t){t.preventDefault(),e.showModal=!1}}},[e._v("Close")]),n("button-with-loading",{staticStyle:{margin:"0 0 0 1rem"},attrs:{text:"Create",type:"main",complete:e.isButtonLoadingComplete},on:{start:e.addNewLink}})],1)],2)],1)},o=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"col-8"},[n("h5",{staticClass:"h3 mb-0"},[e._v("Links")])])}],i=(n("82a8"),n("2a39"),n("2751"),n("96f8"),n("6a61"),n("9ad1")),l=n("2cb5"),c=(n("9102"),n("2984"),n("3aa8")),r=n.n(c),d=(n("086f"),n("ce6c")),u=n.n(d),m=(n("6873"),n("f5ef"),n("5e3a")),p={components:(a={CardLoading:function(){return n.e("chunk-271c3a43").then(n.bind(null,"1190"))},SpreadDynamicLinkInlineActionTable:function(){return Promise.all([n.e("chunk-2d207ecb"),n.e("chunk-386fd0ca"),n.e("chunk-894e4fa4"),n.e("chunk-10f3ed42"),n.e("chunk-7718bdb3")]).then(n.bind(null,"f150"))},flatPicker:function(){return Promise.all([n.e("chunk-2d207ecb"),n.e("chunk-10f3ed42")]).then(n.t.bind(null,"85db",7))}},Object(l["a"])(a,u.a.name,u.a),Object(l["a"])(a,r.a.name,r.a),Object(l["a"])(a,"buttonWithLoading",(function(){return Promise.all([n.e("chunk-2d207ecb"),n.e("chunk-5d7fb187")]).then(n.bind(null,"6ea5"))})),a),data:function(){return{adminUser:null,isLoading:!0,dynamicLinksData:[],showModal:!1,isInvalid:!1,expirationOpen:!1,isButtonLoadingComplete:!1,expiration:"",email:"",name:"",months:{selected:3,options:[0,1,2,3,4,5,6]},salesManParams:[],salesMan:[],links:[],json:{expireIn:1614556800,nonce:"jAHkKLOg2kGvnqUv",status:1,desc:"You are currently PRO now, enjoy TuneKey with unlimited access!",salesManId:"FHSpoJJKF",imageURL:"https://firebasestorage.googleapis.com/v0/b/tunekey-2019.appspot.com/o/images%2Fothers%2Fcoupon.png?alt=media&token=fd25342c-2377-48df-8cd1-3e2c225d6d9a",id:"JPSI82IK2",time:3}}},created:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,a=localStorage.getItem("adminUser"),t.next=4,m["a"].config.doc("salesAccount").get();case 4:s=t.sent,n.$tools.isNull(a)?n.$router.push({name:"AdministrationLogin"}):(n.adminUser=JSON.parse(a),s.data().account===n.adminUser.account&&s.data().password===n.adminUser.password?n.getSalesMan():n.$router.push({name:"AdministrationLogin"}));case 6:case"end":return t.stop()}}),t)})))()},watch:{expirationOpen:function(e,t){this.expiration=e?this.$tools.formatYYMMDD((new Date).getTime()):""}},methods:{getSalesMan:function(){var e=this;m["a"].salesMan.onSnapshot((function(t){if(t.empty)e.salesMan=[];else{var n=[];t.forEach((function(e){n.push(e.data())})),e.salesMan=n}console.log("listen salesMan: ",e.salesMan),e.getLinks()}))},getLinks:function(){var e=this;m["a"].salesManLinks.get().then((function(t){if(t.empty)e.links=[];else{var n=[];t.forEach((function(e){n.push(e.data())})),e.links=n}e.getSalesManParams(),console.log("links: ",e.links)}))},getSalesManParams:function(){var e=this;m["a"].salesManParams.get().then((function(t){if(t.empty)e.salesManParams=[];else{var n=[];t.forEach((function(t){var a=e.$tools.objKeySort(t.data());a.email="",e.salesMan.some((function(e){e.salesManId==t.salesManId&&(a.email=e.email)})),e.links.some((function(e){e.id==t.id&&(a.link=e.link)})),n.push(a)})),e.salesManParams=n}e.isLoading=!1}))},logout:function(){var e=this;localStorage.clear(),e.$router.push({name:"AdministrationLogin"})},addNewLink:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,a={expireIn:n.$tools.isNull(n.expiration)?0:parseInt(new Date(n.expiration).getTime()/1e3),nonce:n.$tools.getRandomString(16),status:1,desc:"You are currently PRO now, enjoy TuneKey with unlimited access!",salesManId:n.$tools.getRandomString(9),imageURL:"https://firebasestorage.googleapis.com/v0/b/tunekey-2019.appspot.com/o/images%2Fothers%2Fcoupon-"+n.months.selected+".png?alt=media&token=fd25342c-2377-48df-8cd1-3e2c225d6d9a",id:n.$tools.getRandomString(9),time:n.months.selected},a=e.$tools.objKeySort(a),s=e.$tools.getJsonKeyValueStr(a),s=s.substring(0,s.length-1),console.log(s),o=String(e.$md5(s)).toUpperCase(),console.log("https://tunekey.app/redirect/i?u="+a.salesManId+"&c="+a.id+"&s="+o),t.next=10,n.$axios.post("https://firebasedynamiclinks.googleapis.com/v1/shortLinks?key=AIzaSyBdUyJmAAbAGEWq0hsbcidOUiaQU1aLxkM",{suffix:{option:"SHORT"},dynamicLinkInfo:{domainUriPrefix:"https://tunekey.app/link",link:"https://tunekey.app/redirect/i?u="+a.salesManId+"&c="+a.id+"&s="+o,androidInfo:{androidPackageName:"com.spelist.tunekey",androidFallbackLink:"https://tunekey.app/download",androidMinPackageVersionCode:"1"},iosInfo:{iosBundleId:"com.spelist.tunekey",iosIpadBundleId:"tunekey",iosAppStoreId:"1479006791"},navigationInfo:{enableForcedRedirect:!1},socialMetaTagInfo:{socialTitle:"",socialDescription:"",socialImageLink:a.imageURL}}}).then(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t),!t.data.shortLink){e.next=19;break}return s=a,s.name=n.name,e.next=6,m["a"].salesManParams.doc(a.id).set(s);case 6:return console.log("set salesManParam"),e.next=9,m["a"].salesManLinks.doc(a.id).set({link:t.data.shortLink,id:a.id});case 9:return console.log("set salesManLinks"),e.next=12,m["a"].salesMan.doc(a.salesManId).set({salesManId:a.salesManId,email:n.email});case 12:return console.log("set salesMan"),e.next=15,m["a"].signUpViaLinkCount.doc(a.id).set({count:0,id:a.id});case 15:console.log("set signUpViaLinkCount"),n.isButtonLoadingComplete=!0,n.showModal=!1,n.$notify({message:"Create Success!",type:"success"});case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log(e)}));case 10:n.name="",n.email="",n.isButtonLoadingComplete=!1;case 13:case"end":return t.stop()}}),t)})))()},validationEmail:function(){var e=this;e.$tools.isNull(e.email)?e.isInvalid=!1:e.isInvalid=!e.$tools.isEmail(e.email)},getDynamicLinks:function(e){return new Promise((function(t,n){db.collection("sales_man_params").where("salesManId","==",e).get().then((function(e){if(e.empty)t([]);else{var n=[];e.forEach((function(e){n.push(e.data())})),t(n)}})).catch((function(e){console.error("Get [sales_man_params] failed, error: ",e),t([])}))}))},getSalesManId:function(e){return new Promise((function(t,n){db.collection("sales_man_record").where("userId","==",e).get().then((function(e){if(e.empty)t(null);else{var n=[];e.forEach((function(e){n.push(e.data())})),t(n[n.length-1])}})).catch((function(e){console.error("Get [sales_man_record] failed, error: ",e),t(null)}))}))}}},g=p,h=(n("6b11"),n("5d22")),f=Object(h["a"])(g,s,o,!1,null,"de0edaee",null);t["default"]=f.exports}}]);
//# sourceMappingURL=chunk-1804281e.bd5714db.js.map