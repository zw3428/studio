(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d29de63"],{"06cb":function(e,t,a){"use strict";t.__esModule=!0;var n=a("a593"),o=i(n),s=a("c865");function i(e){return e&&e.__esModule?e:{default:e}}var l=[],r="@@clickoutsideContext",c=void 0,u=0;function d(e,t,a){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!(a&&a.context&&n.target&&o.target)||e.contains(n.target)||e.contains(o.target)||e===n.target||a.context.popperElm&&(a.context.popperElm.contains(n.target)||a.context.popperElm.contains(o.target))||(t.expression&&e[r].methodName&&a.context[e[r].methodName]?a.context[e[r].methodName]():e[r].bindingFn&&e[r].bindingFn())}}!o.default.prototype.$isServer&&(0,s.on)(document,"mousedown",(function(e){return c=e})),!o.default.prototype.$isServer&&(0,s.on)(document,"mouseup",(function(e){l.forEach((function(t){return t[r].documentHandler(e,c)}))})),t.default={bind:function(e,t,a){l.push(e);var n=u++;e[r]={id:n,documentHandler:d(e,t,a),methodName:t.expression,bindingFn:t.value}},update:function(e,t,a){e[r].documentHandler=d(e,t,a),e[r].methodName=t.expression,e[r].bindingFn=t.value},unbind:function(e){for(var t=l.length,a=0;a<t;a++)if(l[a][r].id===e[r].id){l.splice(a,1);break}delete e[r]}}},1647:function(e,t,a){"use strict";a("2e68")},"2e68":function(e,t,a){},"5e3a":function(e,t,a){"use strict";var n=a("1543");function o(e){return n["a"].firestore().collection(e)}t["a"]={user:o("user"),userOnline:o("user_online"),userUnreadCount:o("user_unread_count"),instrument:o("instrument"),teacher:o("teacher_info"),teacherStudentList:o("students_list"),policies:o("policy"),lessonType:o("lesson_type"),studio:o("studio_info"),cache:o("cache"),makeupPolicy:o("makeup_policy"),cancellationPolicy:o("cancellation_policy"),lessonSchedule:o("lesson_schedule"),lessonReschedule:o("lesson_reschedule"),lessonSchedulePlan:o("lesson_schedule_plan"),lessonScheduleMaterial:o("lesson_schedule_material"),lessonScheduleAssignment:o("lesson_schedule_assignment"),practice:o("practice"),achievement:o("achievement"),material:o("material"),materialHash:o("material_hash"),materialAccessControl:o("material_access_control"),student:o("students_list"),lessonScheduleConfigure:o("lesson_schedule_config"),eventConfig:o("event_config"),block:o("block"),userNotificationConfig:o("user_notification_config"),insightsCount:o("insights_count"),rescheduleMakeupRefund:o("student_reschedule_makeup_refund_history"),lessonCancellation:o("lesson_cancellation"),allowSwapStatistics:o("allow_swap_statistics"),calendarLinkSetting:o("calendar_link_setting"),googleCalendarEvents:o("google_calendar_events"),googleCalendarEventsWatch:o("google_calendar_events_watch"),userNotifications:o("user_notifications"),bugReports:o("bug_reports"),teacherReschedules:o("teacher_reschedules"),errors:o("tk_errors"),couponHistory:o("promo_codes_history"),userReceipt:o("user_receipt"),accessTokenGoogle:o("access_token_google"),appSessions:o("app_sessions"),appSessionActions:o("app_sessions_actions"),appEvents:o("app_events"),config:o("config"),googleEmail:o("google_email"),googleAccessTokenCalendar:o("google_access_token_calendar"),googleAccessTokenDrive:o("google_access_token_drive"),googleAccessTokenPhotos:o("google_access_token_photos"),googleCalendarEventsSyncToken:o("google_calendar_events_sync_token"),teacherPermissions:o("teacher_permissions"),salesMan:o("sales_man"),salesManParams:o("sales_man_params"),salesManRecords:o("sales_man_records"),salesManLinks:o("sales_man_links"),signUpViaLinkCount:o("signup_via_link_count")}},6873:function(e,t,a){},e97a:function(e,t,a){"use strict";a.r(t);var n,o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("notifications"),a("base-header",{staticClass:"pb-6"},[a("div",{staticClass:"row align-items-center py-4"},[a("div",{staticClass:"col-lg-6 col-7"},[a("h6",{staticClass:"h2 text-white d-inline-block mb-0"},[e._v(" TuneKey Dynamic Link ")])]),a("div",{staticClass:"col-lg-6 col-5 text-right"},[a("base-button",{staticClass:"tk-font-color-main",attrs:{size:"sm",type:"neutral"},on:{click:function(t){return t.preventDefault(),e.logout(t)}}},[e._v("Logout")])],1)])]),a("div",{staticClass:"container-fluid mt--6"},[a("div",{staticClass:"card mb-4"},[e.isLoading?e._e():a("div",{staticClass:"card-header"},[a("div",{staticClass:"row align-items-center"},[a("div",{staticClass:"col-8"},[a("span",[e._v("From")]),a("flat-picker",{staticClass:"form-control form-control-muted tk-bg-color-gray-100 datepicker tk-layout-inline-block tk-px-width-px100 tk-px-margin-left-px8 tk-px-height-px36",attrs:{config:{allowInput:!0}},model:{value:e.from,callback:function(t){e.from=t},expression:"from"}}),a("span",[e._v(" - To")]),a("flat-picker",{staticClass:"form-control form-control-muted tk-bg-color-gray-100 datepicker tk-layout-inline-block tk-px-width-px100 tk-px-margin-left-px8 tk-px-height-px36",attrs:{config:{allowInput:!0}},model:{value:e.to,callback:function(t){e.to=t},expression:"to"}}),a("span",{staticClass:"btn btn-sm btn-neutral tk-px-margin-left-px16",class:{"tk-bg-color-gray-400 tk-border-color-gray-400 tk-font-color-white":!e.applyIsEnable,"tk-font-color-main":e.applyIsEnable},on:{click:function(t){return t.preventDefault(),e.initAnalytics(t)}}},[e._v("Apply")])],1),a("div",{staticClass:"col-4 text-right"},[a("span",{staticClass:"btn btn-sm btn-neutral tk-font-color-main",on:{click:function(t){t.preventDefault(),e.showModal=!0}}},[e._v("New Link")])]),a("div",{staticClass:"tk-dynamic-range-filter",staticStyle:{"margin-top":"10px"}},[a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":0===e.range},staticStyle:{color:"#8898aa"},on:{click:function(t){t.preventDefault(),e.range=0}}},[e._v("Total")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":1===e.range},staticStyle:{color:"#8898aa"},on:{click:function(t){t.preventDefault(),e.range=1}}},[e._v("Last 7 days")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":2===e.range},staticStyle:{color:"#8898aa"},on:{click:function(t){t.preventDefault(),e.range=2}}},[e._v("Last 30 days")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":3===e.range},staticStyle:{color:"#8898aa"},on:{click:function(t){t.preventDefault(),e.range=3}}},[e._v("This week")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":4===e.range},staticStyle:{color:"#8898aa"},on:{click:function(t){t.preventDefault(),e.range=4}}},[e._v("This month")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":5===e.range},staticStyle:{color:"#8898aa"},on:{click:function(t){t.preventDefault(),e.range=5}}},[e._v("This quater")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":6===e.range},staticStyle:{color:"#8898aa"},on:{click:function(t){t.preventDefault(),e.range=6}}},[e._v("This year")])])])]),a("div",{staticClass:"card-body",staticStyle:{height:"calc(100vh - 220px)"}},[e.isLoading?a("card-loading"):[a("spread-dynamic-link-inline-action-table",{attrs:{salesManParams:e.salesManParams,accessToken:e.accessToken,from:e.from,to:e.to},on:{analytic:e.analytic}})]],2)])]),a("modal",{attrs:{show:e.showModal},on:{"update:show":function(t){e.showModal=t}}},[a("template",{slot:"header"},[a("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[e._v("New Link")])]),a("div",{staticClass:"tk-popup-content",staticStyle:{"max-height":"60vh","overflow-y":"auto"}},[a("div",[a("span",[a("div",{staticClass:"form-group"},[a("label",{staticClass:"form-control-label"},[e._v("Name")]),a("div",{staticClass:"has-label"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"form-control form-control-muted tk-border-bottom tk-font-color-black1",attrs:{type:"text"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})])])]),a("div",[a("span",[a("div",{staticClass:"form-group"},[a("label",{staticClass:"form-control-label"},[e._v("Email")]),a("div",{staticClass:"has-label"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"form-control form-control-muted tk-border-bottom tk-font-color-black1",class:{"is-invalid":e.isInvalid},attrs:{type:"email"},domProps:{value:e.email},on:{blur:function(t){return t.preventDefault(),e.validationEmail(t)},input:function(t){t.target.composing||(e.email=t.target.value)}}})]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isInvalid,expression:"isInvalid"}],staticClass:"invalid-feedback",staticStyle:{display:"block"}},[e._v(" The email is not correct. ")])])])]),a("span",[a("div",{staticClass:"form-group tk-px-margin-bottom-px0"},[a("label",{staticClass:"form-control-label"},[e._v("Free months")]),a("div",{staticClass:"has-label"},[a("el-select",{staticClass:"tk-select-border-none tk-border-bottom tk-select-bg-mute",model:{value:e.months.selected,callback:function(t){e.$set(e.months,"selected",t)},expression:"months.selected"}},e._l(e.months.options,(function(e,t){return a("el-option",{key:t,attrs:{label:e>0?e+"-MONTH-FREE":"FREE DOWNLOAD",value:e}})})),1)],1)])]),a("img",{staticStyle:{width:"calc(100% - 4rem)",display:"block",margin:"0 auto"},attrs:{src:"/img/coupon/coupon-"+e.months.selected+".png"}}),a("span",[a("div",{staticClass:"form-group card-wrapper tk-px-margin-bottom-px0"},[a("div",{staticClass:"card tk-px-margin-bottom-px16"},[a("div",{staticClass:"form-control",staticStyle:{height:"auto"}},[a("span",{staticClass:"tk-layout-inline-block tk-font-color-black1",staticStyle:{width:"calc(100% - 56px)"}},[e.expirationOpen?[a("span",[e._v("Expiration date")]),a("flat-picker",{staticClass:"form-control form-control-muted tk-bg-color-gray-100 datepicker tk-layout-inline-block tk-px-width-px100 tk-px-margin-left-px10 tk-px-height-px36",attrs:{config:{allowInput:!0}},model:{value:e.expiration,callback:function(t){e.expiration=t},expression:"expiration"}})]:a("span",[e._v("Expiration")])],2),a("base-switch",{staticClass:"mr-1 tk-layout-inline-block",attrs:{"on-text":"On","off-text":"Off",type:"main"},model:{value:e.expirationOpen,callback:function(t){e.expirationOpen=t},expression:"expirationOpen"}})],1)])])])])]),a("template",{slot:"footer"},[a("base-button",{staticClass:"tk-font-color-lightGray tk-border-none",attrs:{type:"secondary"},on:{click:function(t){t.preventDefault(),e.showModal=!1}}},[e._v("Close")]),a("button-with-loading",{staticStyle:{margin:"0 0 0 1rem"},attrs:{text:"Create",type:"main",complete:e.isButtonLoadingComplete},on:{start:e.addNewLink}})],1)],2)],1)},s=[],i=(a("82a8"),a("2a39"),a("2751"),a("96f8"),a("6a61"),a("9ad1")),l=a("2cb5"),r=(a("9102"),a("2984"),a("3aa8")),c=a.n(r),u=(a("086f"),a("ce6c")),d=a.n(u),m=(a("6873"),a("f5ef")),p=a("5e3a"),g={components:(n={CardLoading:function(){return a.e("chunk-271c3a43").then(a.bind(null,"1190"))},SpreadDynamicLinkInlineActionTable:function(){return Promise.all([a.e("chunk-2d207ecb"),a.e("chunk-386fd0ca"),a.e("chunk-894e4fa4"),a.e("chunk-03ee3fd9"),a.e("chunk-39fe77b0")]).then(a.bind(null,"f150"))},flatPicker:function(){return Promise.all([a.e("chunk-2d207ecb"),a.e("chunk-10f3ed42")]).then(a.t.bind(null,"85db",7))}},Object(l["a"])(n,d.a.name,d.a),Object(l["a"])(n,c.a.name,c.a),Object(l["a"])(n,"buttonWithLoading",(function(){return Promise.all([a.e("chunk-2d207ecb"),a.e("chunk-5d7fb187")]).then(a.bind(null,"6ea5"))})),n),data:function(){return{from:"",to:"",range:1,adminUser:null,isLoading:!0,applyIsEnable:!1,dynamicLinksData:[],showModal:!1,isInvalid:!1,expirationOpen:!1,isButtonLoadingComplete:!1,expiration:"",email:"",name:"",months:{selected:3,options:[0,1,2,3,4,5,6]},originSalesManParams:[],salesManParams:[],salesMan:[],links:[],accessToken:"",json:{expireIn:1614556800,nonce:"jAHkKLOg2kGvnqUv",status:1,desc:"You are currently PRO now, enjoy TuneKey with unlimited access!",salesManId:"FHSpoJJKF",imageURL:"https://firebasestorage.googleapis.com/v0/b/tunekey-2019.appspot.com/o/images%2Fothers%2Fcoupon.png?alt=media&token=fd25342c-2377-48df-8cd1-3e2c225d6d9a",id:"JPSI82IK2",time:3}}},created:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,o,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,n=localStorage.getItem("adminUser"),t.next=4,p["a"].config.doc("salesAccount").get();case 4:if(o=t.sent,s=o.data().sales,a.initFromTo(),!a.$tools.isNull(n)){t.next=11;break}a.$router.push({name:"Login"}),t.next=23;break;case 11:a.adminUser=JSON.parse(n),i=0;case 13:if(!(i<s.length)){t.next=23;break}if(s[i].account!==a.adminUser.account||s[i].password!==a.adminUser.password){t.next=19;break}return a.getAccessToken(),t.abrupt("break",23);case 19:i===s.length-1&&a.$router.push({name:"Login"});case 20:i++,t.next=13;break;case 23:case"end":return t.stop()}}),t)})))()},watch:{expirationOpen:function(e,t){this.expiration=e?this.$tools.formatYYMMDD((new Date).getTime()):""},range:function(e,t){this.initFromTo()},from:function(e,t){if(this.applyIsEnable=!0,e.indexOf("-")>-1){var a=this.$tools.formatYYMMDD(new Date(e).getTime());new Date(a).getTime()>(new Date).getTime()&&(a=this.$tools.formatYYMMDD((new Date).getTime())),this.from=a}},to:function(e,t){if(this.applyIsEnable=!0,e.indexOf("-")>-1){var a=this.$tools.formatYYMMDD(new Date(e).getTime());new Date(a).getTime()>(new Date).getTime()&&(a=this.$tools.formatYYMMDD((new Date).getTime())),this.to=a}}},methods:{analytic:function(){this.isLoading=!1,console.log("分析完成")},initAnalytics:function(){var e=this;e.applyIsEnable&&(e.applyIsEnable=!1,m["a"].$emit("analytic"))},initDayFromRange:function(){var e,t=this,a=0,n=new Date,o=n.getDay(),s=t.$tools.formatYYMMDD(n.getTime());switch(t.range){case 0:var i=t.links.sort((function(e,t){return parseInt(e.createTime)-parseInt(t.createTime)}));e=t.$tools.formatYYMMDD(1e3*i[0].createTime),a=t.$tools.getDaysByDateString(e,t.to)-1;break;case 1:a=7;break;case 2:a=30;break;case 3:a=0===o?6:o-1;break;case 4:a=n.getDate()-1;break;case 5:e=t.$tools.getQuarterStartDate(),console.log("quarter start: ",e),a=parseInt((new Date(s).getTime()-new Date(e).getTime())/864e5);break;case 6:a=parseInt((new Date(s).getTime()-new Date(n.getFullYear()+"/1/1").getTime())/864e5);break}return a},initFromTo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,t.next=3,a.initDayFromRange();case 3:n=t.sent,o=new Date,s=new Date,console.log("day:",n),s.setDate(s.getDate()-n),console.log(s),console.log(o),a.to=a.$tools.formatYYMMDD(o.getTime()),console.log(a.to),a.from=a.$tools.formatYYMMDD(s.getTime()),console.log(a.from);case 13:case"end":return t.stop()}}),t)})))()},getAccessToken:function(){var e=this,t=e.$firebase.functions().httpsCallable("getAccessToken");t().then((function(t){console.log("token: ",t),e.$tools.isNull(t.data.data)||(e.accessToken=t.data.data.token),e.getSalesMan()}))},getSalesMan:function(){var e=this;p["a"].salesMan.onSnapshot((function(t){if(t.empty)e.salesMan=[];else{var a=[];t.forEach((function(e){a.push(e.data())})),e.salesMan=a}console.log("listen salesMan: ",e.salesMan),e.getLinks()}))},getLinks:function(){var e=this;p["a"].salesManLinks.get().then((function(t){if(t.empty)e.links=[];else{var a=[];t.forEach((function(t){t.data().creator===e.adminUser.account&&a.push(t.data())})),e.links=a}e.getSalesManParams(),console.log("links: ",e.links)}))},getSalesManParams:function(){var e=this;p["a"].salesManParams.get().then((function(t){if(t.empty)e.salesManParams=[];else{var a=[];t.forEach((function(t){var n=e.$tools.objKeySort(t.data());n.email="",e.salesMan.some((function(e){e.salesManId==n.salesManId&&(n.email=e.email)})),e.links.some((function(e){e.id==n.id&&(n.link=e.link,n.createTime=e.createTime,a.push(n))}))})),e.salesManParams=a}console.log("data: ",e.salesManParams),e.originSalesManParams=e.salesManParams,e.isLoading=!1,e.initDataByRange()}))},initDataByRange:function(){},logout:function(){var e=this;localStorage.clear(),e.$router.push({name:"AdministrationLogin"})},addNewLink:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,n={expireIn:a.$tools.isNull(a.expiration)?0:parseInt(new Date(a.expiration).getTime()/1e3),nonce:a.$tools.getRandomString(16),status:1,desc:"You are currently PRO now, enjoy TuneKey with unlimited access!",salesManId:a.$tools.getRandomString(9),imageURL:"https://firebasestorage.googleapis.com/v0/b/tunekey-2019.appspot.com/o/images%2Fothers%2Fcoupon-"+a.months.selected+".png?alt=media&token=fd25342c-2377-48df-8cd1-3e2c225d6d9a",id:a.$tools.getRandomString(9),time:a.months.selected},n=e.$tools.objKeySort(n),o=e.$tools.getJsonKeyValueStr(n),o=o.substring(0,o.length-1),console.log(o),s=String(e.$md5(o)).toUpperCase(),console.log("https://tunekey.app/redirect/i?u="+n.salesManId+"&c="+n.id+"&s="+s),t.next=10,a.$axios.post("https://firebasedynamiclinks.googleapis.com/v1/shortLinks?key=AIzaSyBdUyJmAAbAGEWq0hsbcidOUiaQU1aLxkM",{suffix:{option:"SHORT"},dynamicLinkInfo:{domainUriPrefix:"https://tunekey.app/link",link:"https://tunekey.app/redirect/i?u="+n.salesManId+"&c="+n.id+"&s="+s+"&t="+(new Date).getTime(),androidInfo:{androidPackageName:"com.spelist.tunekey",androidFallbackLink:"https://tunekey.app/download",androidMinPackageVersionCode:"1"},iosInfo:{iosBundleId:"com.spelist.tunekey",iosIpadBundleId:"tunekey",iosAppStoreId:"1479006791"},navigationInfo:{enableForcedRedirect:!1},socialMetaTagInfo:{socialTitle:"",socialDescription:"",socialImageLink:n.imageURL}}}).then(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t),!t.data.shortLink){e.next=15;break}return o=n,o.name=a.name,e.next=6,p["a"].salesManParams.doc(n.id).set(o);case 6:return e.next=8,p["a"].salesManLinks.doc(n.id).set({link:t.data.shortLink,id:n.id,createTime:parseInt((new Date).getTime()/1e3),creator:a.adminUser.account});case 8:return e.next=10,p["a"].salesMan.doc(n.salesManId).set({salesManId:n.salesManId,email:a.email});case 10:return e.next=12,p["a"].signUpViaLinkCount.doc(n.id).set({count:0,id:n.id});case 12:a.isButtonLoadingComplete=!0,a.showModal=!1,a.$notify({message:"Create Success!",type:"success"});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log(e)}));case 10:a.name="",a.email="",a.isButtonLoadingComplete=!1;case 13:case"end":return t.stop()}}),t)})))()},validationEmail:function(){var e=this;e.$tools.isNull(e.email)?e.isInvalid=!1:e.isInvalid=!e.$tools.isEmail(e.email)},getDynamicLinks:function(e){return new Promise((function(t,a){db.collection("sales_man_params").where("salesManId","==",e).get().then((function(e){if(e.empty)t([]);else{var a=[];e.forEach((function(e){a.push(e.data())})),t(a)}})).catch((function(e){console.error("Get [sales_man_params] failed, error: ",e),t([])}))}))},getSalesManId:function(e){return new Promise((function(t,a){db.collection("sales_man_record").where("userId","==",e).get().then((function(e){if(e.empty)t(null);else{var a=[];e.forEach((function(e){a.push(e.data())})),t(a[a.length-1])}})).catch((function(e){console.error("Get [sales_man_record] failed, error: ",e),t(null)}))}))}}},f=g,k=(a("1647"),a("5d22")),h=Object(k["a"])(f,o,s,!1,null,"5fe3c45c",null);t["default"]=h.exports}}]);
//# sourceMappingURL=chunk-6d29de63.90956cd6.js.map