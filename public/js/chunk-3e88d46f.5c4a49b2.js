(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e88d46f"],{"5e3a":function(e,t,n){"use strict";var o=n("1543");function a(e){return o["a"].firestore().collection(e)}t["a"]={user:a("user"),userOnline:a("user_online"),userUnreadCount:a("user_unread_count"),instrument:a("instrument"),teacher:a("teacher_info"),teacherStudentList:a("students_list"),policies:a("policy"),lessonType:a("lesson_type"),studio:a("studio_info"),cache:a("cache"),makeupPolicy:a("makeup_policy"),cancellationPolicy:a("cancellation_policy"),lessonSchedule:a("lesson_schedule"),lessonReschedule:a("lesson_reschedule"),lessonSchedulePlan:a("lesson_schedule_plan"),lessonScheduleMaterial:a("lesson_schedule_material"),lessonScheduleAssignment:a("lesson_schedule_assignment"),practice:a("practice"),achievement:a("achievement"),material:a("material"),materialHash:a("material_hash"),materialAccessControl:a("material_access_control"),student:a("student_info"),lessonScheduleConfigure:a("lesson_schedule_config"),eventConfig:a("event_config"),block:a("block"),userNotificationConfig:a("user_notification_config"),insightsCount:a("insights_count"),rescheduleMakeupRefund:a("student_reschedule_makeup_refund_history"),lessonCancellation:a("lesson_cancellation"),allowSwapStatistics:a("allow_swap_statistics"),calendarLinkSetting:a("calendar_link_setting"),googleCalendarEvents:a("google_calendar_events"),googleCalendarEventsWatch:a("google_calendar_events_watch"),userNotifications:a("user_notifications"),bugReports:a("bug_reports"),teacherReschedules:a("teacher_reschedules"),errors:a("tk_errors"),couponHistory:a("promo_codes_history"),userReceipt:a("user_receipt"),accessTokenGoogle:a("access_token_google"),appSessions:a("app_sessions"),appSessionActions:a("app_sessions_actions"),appEvents:a("app_events"),config:a("config"),googleEmail:a("google_email"),googleAccessTokenCalendar:a("google_access_token_calendar"),googleAccessTokenDrive:a("google_access_token_drive"),googleAccessTokenPhotos:a("google_access_token_photos"),googleCalendarEventsSyncToken:a("google_calendar_events_sync_token"),teacherPermissions:a("teacher_permissions"),salesMan:a("sales_man"),salesManParams:a("sales_man_params"),salesManRecords:a("sales_man_records"),salesManLinks:a("sales_man_links"),signUpViaLinkCount:a("signup_via_link_count")}},"60e4":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("notifications"),n("img",{staticStyle:{width:"50%",position:"absolute",top:"0",left:"0"},attrs:{src:"/img/brand/tk_login_pic.png"}}),n("div",{staticClass:"container",staticStyle:{position:"relative","z-index":"1"}},[n("div",{staticClass:"row justify-content-center"},[n("div",{staticClass:"tk-bg-color-white tk-px-margin-top-px100 tk-text-center"},[2!==e.step?n("img",{staticClass:"tk-px-width-px90",attrs:{src:"/img/brand/tk_logo_icon.png"}}):n("avatar",{attrs:{uId:e.model.userId,studioId:e.model.studioId,name:e.model.fullName}}),n("fade-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:e.failed,expression:"failed"}],staticClass:"tk-font-color-orange tk-px-margin-top-px30 text-lg"},[n("span",{staticClass:"tk-opacity-0"},[e._v("0")]),n("span",{staticClass:"text-sm"},[e._v(e._s(e.failedMsg))]),n("span",{staticClass:"tk-opacity-0"},[e._v("0")])])]),n("fade-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:!e.failed,expression:"!failed"}],staticClass:"tk-font-color-lightGray tk-px-margin-top-px30 text-lg"},[2!==e.step?n("span",[e._v("Get started")]):n("span",[e._v(e._s(e.model.fullName))])])])],1)]),n("div",{staticClass:"row justify-content-center"},[n("div",{staticClass:"col-lg-5 col-md-7 tk-px-margin-top-px30"},[n("validation-observer",{ref:"formValidator"},[n("form",{staticStyle:{width:"335px",margin:"0 auto"},attrs:{role:"form"}},[1===e.step?[n("base-input",{attrs:{alternative:"",name:"Email",rules:{required:!1,email:!0},"prepend-icon":"ni ni-email-83",placeholder:"Your email",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200",id:"loginAccount"},model:{value:e.model.email,callback:function(t){e.$set(e.model,"email",t)},expression:"model.email"}}),n("div",{staticClass:"text-center"},[n("button-with-loading",{staticStyle:{margin:"10px auto 1rem"},attrs:{text:"NEXT",width:"180",type:e.invalidEmail?"disable":"main",complete:e.isButtonLoadingComplete},on:{start:e.next}})],1),n("div",{staticClass:"text-center text-muted mb-4 tk-px-margin-top-px0"},[n("small",[e._v("or")]),n("div",{staticClass:"btn-wrapper text-center"},[n("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"20px auto",padding:"0"},on:{click:function(t){return t.preventDefault(),e.loginWithFacebook(t)}}},[n("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#3b5998","line-height":"50px",width:"50px",height:"50px"}},[n("i",{staticClass:"fab fa-facebook-f"})]),n("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[e._v("Log In with Facebook")])]),n("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"14px auto",padding:"0"},on:{click:function(t){return t.preventDefault(),e.loginWithGoogle(t)}}},[n("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#dc4e41","line-height":"50px",width:"50px",height:"50px"}},[n("i",{staticClass:"fab fa-google"})]),n("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[e._v("Log In with Google")])]),n("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"14px auto",padding:"0"},on:{click:function(t){return t.preventDefault(),e.loginWithApple(t)}}},[n("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#222","line-height":"50px",width:"50px",height:"50px"}},[n("i",{staticClass:"fab fa-apple"})]),n("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[e._v("Log In with Apple")])])])])]:e._e(),2===e.step?[n("base-input",{staticClass:"tk-form-input-pwd",attrs:{alternative:"",name:"Password",rules:{required:!1,min:6,max:6},"prepend-icon":"ni ni-lock-circle-open",type:"password",placeholder:"Password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:e.model.password,callback:function(t){e.$set(e.model,"password",t)},expression:"model.password"}}),n("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light tk-text-right",on:{click:function(t){return t.preventDefault(),e.forgotPwd(t)}}},[e._v(" Forgot password? ")]),n("div",{staticClass:"text-center"},[n("button-with-loading",{staticStyle:{margin:"30px auto 10px"},attrs:{text:"LOGIN",width:"180",type:e.invalidPwd?"disable":"main",complete:e.isButtonLoadingComplete},on:{click:e.login}}),n("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light",on:{click:function(t){return t.preventDefault(),e.notMe(t)}}},[e._v(" Not me? ")])],1)]:e._e(),3===e.step?[n("base-input",{attrs:{alternative:"",name:"Name","prepend-icon":"ni ni-single-02",placeholder:"Full name",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:e.model.fullName,callback:function(t){e.$set(e.model,"fullName",t)},expression:"model.fullName"}}),n("base-input",{attrs:{alternative:"",name:"Password","prepend-icon":"ni ni-lock-circle-open",rules:{required:!1,min:6,max:6},type:"password",placeholder:"Password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:e.model.password,callback:function(t){e.$set(e.model,"password",t)},expression:"model.password"}}),n("base-input",{staticClass:"tk-form-input-pwd",attrs:{alternative:"",name:"Password","prepend-icon":"ni ni-lock-circle-open",rules:{required:!1,min:6,max:6},type:"password",placeholder:"Confirm password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:e.model.password2,callback:function(t){e.$set(e.model,"password2",t)},expression:"model.password2"}}),e.passwordNotSame&&!e.invalidPwd2?n("div",{staticClass:"invalid-feedback",staticStyle:{display:"block"}},[e._v(" The two passwords are not the same ")]):e._e(),n("div",{staticClass:"text-center"},[n("button-with-loading",{staticStyle:{margin:"24px auto 1rem"},attrs:{text:"SIGN UP",width:"180",type:e.invalidPwd||e.invalidPwd2||""===e.model.fullName?"disable":"main",complete:e.isButtonLoadingComplete},on:{click:e.signup}}),n("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light",on:{click:function(t){return t.preventDefault(),e.notMe(t)}}},[e._v(" Already have an account? ")])],1)]:e._e()],2)])],1)])]),e.alert.isShow?n("alert",{attrs:{title:this.alert.title,content:this.alert.content,left:this.alert.buttons.left.title,right:this.alert.buttons.right.title},on:{onLeftTapped:this.alert.buttons.left.action,onRightTapped:this.alert.buttons.right.action}}):e._e()],1)},a=[],i=(n("5194"),n("82a8"),n("2a39"),n("96f8"),n("f923")),s=(n("6a61"),n("9ad1")),l=n("fdc1"),r=n("a336"),c=n.n(r),u=(n("f5ef"),n("41dc")),d=n("5e3a"),p={components:{avatar:function(){return Promise.resolve().then(n.bind(null,"7a12"))},buttonWithLoading:function(){return n.e("chunk-5d7fb187").then(n.bind(null,"6ea5"))},FadeTransition:u["b"],alert:function(){return n.e("chunk-2d0bdced").then(n.bind(null,"2e26"))}},data:function(){return{model:{fullName:"",email:"",password:"",password2:"",rememberMe:!1,userId:"",studioId:""},invalidEmail:!0,invalidPwd:!0,invalidPwd2:!0,email:"zw@gmail.com",step:1,passwordNotSame:!1,loading:!1,isButtonLoadingComplete:!1,failed:!1,failedMsg:"",alert:{isShow:!1,title:"",content:"",buttons:{left:{title:"",action:function(){}},right:{title:"",action:function(){}}}},marketerAccount:[],isMarketer:!1,account:""}},created:function(){this.getMarketer()},mounted:function(){console.log("进入login页面")},watch:{failed:function(e){var t=this;e&&setTimeout((function(){t.failed=!1,t.failedMsg=""}),1e3)},model:{handler:function(e,t){if(!this.loading){this.$tools.isEmail(e.email)?(console.log("输入的是email"),this.invalidEmail=!1):(this.invalidEmail=!0,0===c()("#loginAccount").find(".invalid-feedback").length&&(this.invalidEmail=!1));for(var n=0;n<this.marketerAccount.length;n++){if(this.marketerAccount[n].account===e.email){this.invalidEmail=!1,this.isMarketer=!0,this.account=e.email,setTimeout((function(){c()("#loginAccount").find(".invalid-feedback").hide()}),10);break}n==this.marketerAccount.length-1&&(this.isMarketer=!1,this.account="")}6===e.password.length?this.invalidPwd=!1:this.invalidPwd=!0,6===e.password2.length?(this.invalidPwd2=!1,e.password2===e.password?this.passwordNotSame=!1:this.passwordNotSame=!0):this.invalidPwd2=!0}},deep:!0}},methods:{getMarketer:function(){console.log("获取 market 账号信息");var e=this;d["a"].config.doc("salesAccount").get().then((function(t){t.exists&&e.marketerAccount.push(t.data())}))},getUserInfo:function(){var e=this;return new Promise(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(n,o){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$firebase.firestore().collection("user").where("loginMethod","array-contains-any",[{method:1,account:e.model.email},{method:2,account:e.model.email},{method:3,account:e.model.email},{method:4,account:e.model.email}]).get();case 3:a=t.sent,i=[],a.forEach((function(e){i.push(e.data())})),console.log("获取到的用户列表：",i),i.length>0?(console.log("返回第一个用户信息：",i[0]),n(i[0])):(console.log("用户信息为空"),n(null)),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),o(t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e,n){return t.apply(this,arguments)}}())},getTeacherInfo:function(e){var t=this;return new Promise(function(){var n=Object(s["a"])(regeneratorRuntime.mark((function n(o,a){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.$firebase.firestore().collection("teacher_info").doc(e).get();case 3:i=n.sent,console.log("获取到的教师信息: ",i),o(i.data()),n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),a(n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e,t){return n.apply(this,arguments)}}())},next:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,o,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e,n.invalidEmail||n.loading){t.next=36;break}if(n.isMarketer){t.next=35;break}return n.loading=!0,t.next=6,n.getUserInfo();case 6:if(o=t.sent,console.log("获取到的用户信息：",o),null===o){t.next=25;break}if(!n.$tools.isTeacher(o.roleIds)){t.next=21;break}return t.next=12,n.getTeacherInfo(o.userId);case 12:a=t.sent,console.log("获取到的教师信息: ",a),n.isButtonLoadingComplete=!0,n.step=2,n.model.fullName=o.name,n.model.userId=o.userId,n.model.studioId=a.studioId,t.next=23;break;case 21:n.isButtonLoadingComplete=!0,console.log("当前身份是学生,退出登录");case 23:t.next=32;break;case 25:return console.log("校验email是否正确"),t.next=28,l["a"].emailValidVerify(n.model.email);case 28:s=t.sent,console.log("当前email合法性: ",s),console.log("当前校验结果类型: ",Object(i["a"])(s)),s?(console.log("当前email合法"),n.isButtonLoadingComplete=!0,n.step=3,n.model.fullName=""):(console.log("Email 不合法: ",n.model.email),n.alert.title="Wrong email",n.alert.content="This email address \n("+n.model.email+") \ndoesn't exist or temporatily couldn't receive message.",n.alert.buttons.left.title="Go Back",n.alert.buttons.left.action=function(){n.alert.isShow=!1,n.isButtonLoadingComplete=!0},n.alert.buttons.right.title="Continue",n.alert.buttons.right.action=function(){n.alert.title="Continue?",n.alert.content="Are you sure to continue with this wrong email address \n("+n.model.email+")?",n.alert.buttons.left.title="Go Back",n.alert.buttons.right.title="Continue",n.alert.buttons.right.action=function(){n.isButtonLoadingComplete=!0,n.step=3,n.model.fullName="",n.alert.isShow=!1},n.alert.isShow=!0},n.alert.isShow=!0);case 32:n.isButtonLoadingComplete=!1,t.next=36;break;case 35:n.$router.push({name:"AdministrationLogin",query:{account:n.account}});case 36:case"end":return t.stop()}}),t)})))()},notMe:function(){var e=this;e.model.fullName="",e.model.password="",e.model.password2="",e.invalidPwd=!0,e.invalidPwd2=!0,e.step=1},forgotPwd:function(){},login:function(){var e=this;e.$tools.isNull(e.model.email)||(e.loading=!0,e.$firebase.auth().signInWithEmailAndPassword(e.model.email,e.model.password).then((function(t){console.log("登陆成功：",t),e.loading=!1,e.isButtonLoadingComplete=!0})).catch((function(t){console.error("登陆失败：",t),e.isButtonLoadingComplete=!1}))),e.isButtonLoadingComplete=!1},loginWithFacebook:function(){console.log("ready to sign in with Facebook");var e=this;if(!e.loading){var t=e.$firebase,n=new t.auth.FacebookAuthProvider;e.signIn(n)}},loginWithGoogle:function(){console.log("ready to sign in with Google");var e=this;if(!e.loading){var t=e.$firebase,n=new t.auth.GoogleAuthProvider;e.signIn(n)}},loginWithApple:function(){console.log("ready to sign in with Apple");var e=this;if(!e.loading){var t=e.$firebase,n=new t.auth.OAuthProvider("apple.com");n.addScope("email"),n.addScope("name"),e.signIn(n)}},signIn:function(e){var t=this,n=t.$firebase;n.auth().signInWithPopup(e).then((function(e){console.log("login success");var t=e.credential.accessToken;localStorage.setItem("auth_token",t);var n=e.user;localStorage.setItem("auth_user",n)})).catch((function(e){console.error("login failed:",e)}))},signup:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,o,a,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e,n.$tools.isNull(n.model.fullName)||n.$tools.isNull(n.model.password)||n.$tools.isNull(n.model.password2)||n.loading){t.next=16;break}return console.log("点击注册"),t.next=5,l["a"].emailValidVerify(e.model.email);case 5:return o=t.sent,o||e.$notify({message:"The email is wrong",type:"warning"}),console.log("校验结果: ",o),n.loading=!0,a=n.$firebase,i=a.functions().httpsCallable("teacherSignup"),t.next=13,i({email:n.model.email,password:n.model.password,fullName:n.model.fullName});case 13:s=t.sent,console.log("获取到的注册结果: ",s),s.data?0===s.data.code?e.login():console.log("sign up failed: ",s):console.error("sign up failed: ",s);case 16:case"end":return t.stop()}}),t)})))()}}},m=p,g=n("5d22"),h=Object(g["a"])(m,o,a,!1,null,null,null);t["default"]=h.exports},"84c9":function(e,t,n){var o=n("4292"),a=n("bc5d"),i=n("274c").f,s=a((function(){return!Object.getOwnPropertyNames(1)}));o({target:"Object",stat:!0,forced:s},{getOwnPropertyNames:i})},f923:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("6b07"),n("cf2b"),n("08b3"),n("2a39"),n("f39f"),n("4021");function o(e){return o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}},fdc1:function(e,t,n){"use strict";n("84c9"),n("2a39");var o=n("73ef"),a=n.n(o);n("948b");function i(e){switch(e.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}function s(e){return new Promise((function(t,n){var o=["test-","@tunekey.test",".test","@tk.com","@tunekey.com","@tunkey.com"];o.forEach((function(n){e.indexOf(n)>=0&&t(!0)}));var s="https://emailverification.whoisxmlapi.com/api/v1?apiKey=at_wU22I8A8DpX6v2sXO1XT3hlEBdFtG&emailAddress="+e;a.a.get(s).then((function(e){if(e.status&&200===e.status){var n=e.data;if(n)return console.log("[Email校验] => 校验结果: ",JSON.stringify(n)),void t(i(n.smtpCheck))}t(!1)})).catch((function(e){console.error(e),n(e)}))}))}function l(){var e=localStorage.getItem("auth_user");if(""!==e){var t=JSON.parse(e);if(t)return t.uid}return""}function r(e,t){var n=Object.getOwnPropertyNames(e),o=Object.getOwnPropertyNames(t);if(n.length!=o.length)return!1;for(var a=0,i=n.length;a<i;a++){var s=n[a];if(this[s]!==e[s])return!1}return!0}var c={emailValidVerify:s,userId:l,objEquals:r};t["a"]=c}}]);
//# sourceMappingURL=chunk-3e88d46f.5c4a49b2.js.map