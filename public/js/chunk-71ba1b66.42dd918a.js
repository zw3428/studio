(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71ba1b66"],{"2b84":function(e,t,n){"use strict";n("4914"),n("82a8"),n("2a39"),n("f39f"),n("96f8"),n("4021");var r=n("f923"),a=(n("6a61"),n("9ad1")),s=(n("e204"),n("948b"),n("fdc1")),o=n("9194"),u=n("5e3a"),c=n("fef9"),i=n("a125");t["a"]={listAllTeachers:function(){return new Promise(function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n){var a,o,u,l,f,h,d,p,m,g,v,y;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,console.log("开始获取所有的教师信息"),e.next=4,c["a"].studioInfo();case 4:return a=e.sent,console.log("获取到的studioinfo: ",a),o=a.id,e.next=9,i["a"].getTeachersByStudioId(o);case 9:for(u=e.sent,console.log("获取到的教师信息: ",u),l={},f=[],h=[],d=0;d<u.length;d++)p=u[d].userId,u[d]["avatar"]=s["a"].studioLogoPath(u[d].studioId),f.push(i["a"].getUserInfoByUserId(p)),h.push(i["a"].getStudentsByTeacherId(p)),l[p]=u[d];return e.next=17,Promise.all(f);case 17:return m=e.sent,console.log("获取用户详情: ",m),e.next=21,Promise.all(h);case 21:g=e.sent,console.log("获取学生详情: ",g),m.forEach((function(e){var t=e.userId,n=l[t];console.log("------",n),n.phone=e.phone,n.email=e.email,n.website=e.website,n.active=e.active,n.name=e.name,n.studentCount=0,n.students=[],l[t]=n})),g.forEach((function(e){e.forEach((function(e){var t=e.teacherId,n=l[t],a=n.students;void 0!==Object(r["a"])(a)&&null!==a||(a=[]),a.push(e),n.students=a,n.studentCount=n.students.length,l[t]=n}))})),console.log("所有的教师信息: ",l),v=[],e.t0=regeneratorRuntime.keys(l);case 28:if((e.t1=e.t0()).done){e.next=36;break}return y=e.t1.value,e.next=32,i["a"].getTeacherFutureLessonsCountByTeacherId(y);case 32:l[y].lessonsCount=e.sent,v.push(l[y]),e.next=28;break;case 36:console.log("最后的数据:",v),t(v),e.next=43;break;case 40:e.prev=40,e.t2=e["catch"](0),n(e.t2);case 43:case"end":return e.stop()}}),e,null,[[0,40]])})));return function(t,n){return e.apply(this,arguments)}}())},listNextLessonsByTeacher:function(e){return new Promise(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n,r){var a,u,c,l,f,h;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i["a"].getStudentsByTeacherId(e);case 3:a=t.sent,console.log("该老师的所有学生：",a),u=[],c=0;case 7:if(!(c<a.length)){t.next=42;break}return t.next=10,i["a"].getStudentNextLesson(a[c].studentId,a[c].teacherId);case 10:if(l=t.sent,null===l){t.next=39;break}return console.log("next lesosn: ",l),t.next=15,i["a"].getInstrumentById(l.instrumentId);case 15:if(f=t.sent,h=l.lessonScheduleData,!o["a"].isNull(h)){t.next=19;break}return t.abrupt("continue",39);case 19:return console.log("instrument",f),t.t0=u,t.t1=l.id,t.next=24,i["a"].getUserName(l.studentId);case 24:t.t2=t.sent,t.t3=s["a"].userAvatarPath(l.studentId),t.t4=f.name,t.t5=f.minPictureUrl,t.t6=l.instrumentId,t.t7=l.lessonTypeData.name,t.t8=s["a"].formatPrice(l.lessonTypeData.price),t.t9=l.lessonTypeData.timeLength+"min",t.t10=s["a"].formatRepeatType(h.repeatType),t.t11=o["a"].formatWeekday(1e3*l.shouldDateTime)+". "+o["a"].formatHHMMAP(1e3*l.shouldDateTime),t.t12=l.studentId,t.t13=l.teacherId,t.t14=l,t.t15={id:t.t1,name:t.t2,avatar:t.t3,instrument:t.t4,icon:t.t5,instrumentId:t.t6,lessonTypeName:t.t7,price:t.t8,timeLength:t.t9,repeatType:t.t10,schedule:t.t11,studentId:t.t12,teacherId:t.t13,originData:t.t14},t.t0.push.call(t.t0,t.t15);case 39:c++,t.next=7;break;case 42:console.log("最后获取的 lesson 数据: ",u),n(u),t.next=49;break;case 46:t.prev=46,t.t16=t["catch"](0),r(t.t16);case 49:case"end":return t.stop()}}),t,null,[[0,46]])})));return function(e,n){return t.apply(this,arguments)}}())},addLessonType:function(e){return new Promise(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n,r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u["a"].lessonType.doc(e.id).set(e).then((function(){n(!0)}));case 3:t.next=9;break;case 5:t.prev=5,t.t0=t["catch"](0),console.log(t.t0),n(!1);case 9:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(e,n){return t.apply(this,arguments)}}())},updateLessonConfig:function(e){return new Promise(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n,r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u["a"].lessonScheduleConfigure.doc(e.id).update(e).then((function(){n(!0)}));case 3:t.next=9;break;case 5:t.prev=5,t.t0=t["catch"](0),console.log(t.t0),n(!1);case 9:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(e,n){return t.apply(this,arguments)}}())},listAllLessonsByTeacher:function(e,t){var n=o["a"].isNull(t)?new Date:new Date(t),r=o["a"].isNull(t)?new Date:new Date(t);n.setMonth(n.getMonth()-1),r.setMonth(r.getMonth()+1);var c=parseInt(new Date(n.getFullYear()+"/"+(n.getMonth()+1)+"/1").getTime()/1e3),i=parseInt(new Date(r.getFullYear()+"/"+(r.getMonth()+1)+"/"+o["a"].getDaysInMonth(r.getTime())).getTime()/1e3);return console.log(c,i),new Promise(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n,r){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u["a"].lessonSchedule.where("teacherId","==",e).where("shouldDateTime",">=",c).where("shouldDateTime","<=",i).get();case 3:a=t.sent,o=[],a.empty||a.forEach((function(e){if(e.exists){var t=e.data();t.url=s["a"].userAvatarPath(t.studentId),t.isOverDay=!1,t.type=1,t.name=t.lessonTypeData.name,t.shouldDateTime=1e3*t.shouldDateTime,o.push(t)}})),n(o),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),r(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e,n){return t.apply(this,arguments)}}())},listAllEventsByTeacher:function(e,t){return new Promise(function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:try{r=[],t(r)}catch(a){n(a)}case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())},listLessonsAndEventsByTeacherId:function(e,t){var n=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){var a,s,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,n.listAllLessonsByTeacher(e,t);case 2:return a=r.sent,r.next=5,n.listAllEventsByTeacher(e,t);case 5:return s=r.sent,o=a.concat(s),r.abrupt("return",o);case 8:case"end":return r.stop()}}),r)})))()}}},4914:function(e,t,n){"use strict";var r=n("4292"),a=n("bc5d"),s=n("a308"),o=n("3079"),u=n("4326"),c=n("2730"),i=n("5c14"),l=n("698e"),f=n("b9d5"),h=n("9345"),d=n("b4f5"),p=h("isConcatSpreadable"),m=9007199254740991,g="Maximum allowed index exceeded",v=d>=51||!a((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),y=f("concat"),w=function(e){if(!o(e))return!1;var t=e[p];return void 0!==t?!!t:s(e)},b=!v||!y;r({target:"Array",proto:!0,forced:b},{concat:function(e){var t,n,r,a,s,o=u(this),f=l(o,0),h=0;for(t=-1,r=arguments.length;t<r;t++)if(s=-1===t?o:arguments[t],w(s)){if(a=c(s.length),h+a>m)throw TypeError(g);for(n=0;n<a;n++,h++)n in s&&i(f,h,s[n])}else{if(h>=m)throw TypeError(g);i(f,h++,s)}return f.length=h,f}})},f923:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n("6b07"),n("cf2b"),n("08b3"),n("2a39"),n("f39f"),n("4021");function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}}}]);
//# sourceMappingURL=chunk-71ba1b66.42dd918a.js.map