(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c8b5b0a6"],{"3e83":function(t,e,o){"use strict";o.d(e,"a",(function(){return n}));o("2522"),o("de78"),o("6019"),o("c585"),o("a0ef"),o("281b");function n(t){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}},"60e4":function(t,e,o){"use strict";o.r(e);var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("notifications"),o("img",{staticStyle:{width:"50%",position:"absolute",top:"0",left:"0"},attrs:{src:"/img/brand/tk_login_pic.png"}}),o("div",{staticClass:"container",staticStyle:{position:"relative","z-index":"1"}},[o("div",{staticClass:"row justify-content-center"},[o("div",{staticClass:"tk-bg-color-white tk-px-margin-top-px100 tk-text-center"},[2!==t.step?o("img",{staticClass:"tk-px-width-px90",attrs:{src:"/img/brand/tk_logo_icon.png"}}):o("avatar",{attrs:{uId:t.model.userId,studioId:t.model.studioId,name:t.model.fullName}}),o("fade-transition",[o("div",{directives:[{name:"show",rawName:"v-show",value:t.failed,expression:"failed"}],staticClass:"tk-font-color-orange tk-px-margin-top-px30 text-lg"},[o("span",{staticClass:"tk-opacity-0"},[t._v("0")]),o("span",{staticClass:"text-sm"},[t._v(t._s(t.failedMsg))]),o("span",{staticClass:"tk-opacity-0"},[t._v("0")])])]),o("fade-transition",[o("div",{directives:[{name:"show",rawName:"v-show",value:!t.failed,expression:"!failed"}],staticClass:"tk-font-color-lightGray tk-px-margin-top-px30 text-lg"},[2!==t.step?o("span",[t._v("Get started")]):o("span",[t._v(t._s(t.model.fullName))])])])],1)]),o("div",{staticClass:"row justify-content-center"},[o("div",{staticClass:"col-lg-5 col-md-7 tk-px-margin-top-px30"},[o("validation-observer",{ref:"formValidator"},[o("form",{staticStyle:{width:"335px",margin:"0 auto"},attrs:{role:"form"}},[1===t.step?[o("base-input",{attrs:{alternative:"",name:"Email",rules:{required:!1,email:!0},"prepend-icon":"ni ni-email-83",placeholder:"Your email",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200",id:"loginAccount"},model:{value:t.model.email,callback:function(e){t.$set(t.model,"email",e)},expression:"model.email"}}),o("div",{staticClass:"text-center"},[o("button-with-loading",{staticStyle:{margin:"10px auto 1rem"},attrs:{text:"NEXT",width:"180",type:t.invalidEmail?"disable":"main",complete:t.isButtonLoadingComplete},on:{start:t.next}})],1),o("div",{staticClass:"text-center text-muted mb-4 tk-px-margin-top-px0"},[o("small",[t._v("or")]),o("div",{staticClass:"btn-wrapper text-center"},[o("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"20px auto",padding:"0"},on:{click:function(e){return e.preventDefault(),t.loginWithFacebook(e)}}},[o("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#3b5998","line-height":"50px",width:"50px",height:"50px"}},[o("i",{staticClass:"fab fa-facebook-f"})]),o("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[t._v("Log In with Facebook")])]),o("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"14px auto",padding:"0"},on:{click:function(e){return e.preventDefault(),t.loginWithGoogle(e)}}},[o("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#dc4e41","line-height":"50px",width:"50px",height:"50px"}},[o("i",{staticClass:"fab fa-google"})]),o("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[t._v("Log In with Google")])]),o("div",{staticClass:"btn btn-neutral btn-icon tk-border-color-gray-200",staticStyle:{display:"block",width:"300px",height:"50px",margin:"14px auto",padding:"0"},on:{click:function(e){return e.preventDefault(),t.loginWithApple(e)}}},[o("span",{staticClass:"btn-inner--icon tk-layout-inline-block tk-font-color-white tk-px-radius-px5",staticStyle:{"background-color":"#222","line-height":"50px",width:"50px",height:"50px"}},[o("i",{staticClass:"fab fa-apple"})]),o("span",{staticClass:"btn-inner--text tk-layout-inline-block tk-font-color-lightGray",staticStyle:{width:"calc(100% - 50px)","margin-left":"0"}},[t._v("Log In with Apple")])])])])]:t._e(),2===t.step?[o("base-input",{staticClass:"tk-form-input-pwd",attrs:{alternative:"",name:"Password",rules:{required:!1,min:6,max:6},"prepend-icon":"ni ni-lock-circle-open",type:"password",placeholder:"Password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.password,callback:function(e){t.$set(t.model,"password",e)},expression:"model.password"}}),o("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light tk-text-right",on:{click:function(e){return e.preventDefault(),t.forgotPwd(e)}}},[t._v(" Forgot password? ")]),o("div",{staticClass:"text-center"},[o("button-with-loading",{staticStyle:{margin:"30px auto 10px"},attrs:{text:"LOGIN",width:"180",type:t.invalidPwd?"disable":"main",complete:t.isButtonLoadingComplete},on:{click:t.login}}),o("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light",on:{click:function(e){return e.preventDefault(),t.notMe(e)}}},[t._v(" Not me? ")])],1)]:t._e(),3===t.step?[o("base-input",{attrs:{alternative:"",name:"Name","prepend-icon":"ni ni-single-02",placeholder:"Full name",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.fullName,callback:function(e){t.$set(t.model,"fullName",e)},expression:"model.fullName"}}),o("base-input",{attrs:{alternative:"",name:"Password","prepend-icon":"ni ni-lock-circle-open",rules:{required:!1,min:6,max:6},type:"password",placeholder:"Password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.password,callback:function(e){t.$set(t.model,"password",e)},expression:"model.password"}}),o("base-input",{staticClass:"tk-form-input-pwd",attrs:{alternative:"",name:"Password","prepend-icon":"ni ni-lock-circle-open",rules:{required:!1,min:6,max:6},type:"password",placeholder:"Confirm password",inputClasses:"tk-px-height-px64",inputGroupClasses:"tk-border-color-gray-200"},model:{value:t.model.password2,callback:function(e){t.$set(t.model,"password2",e)},expression:"model.password2"}}),t.passwordNotSame&&!t.invalidPwd2?o("div",{staticClass:"invalid-feedback",staticStyle:{display:"block"}},[t._v(" The two passwords are not the same ")]):t._e(),o("div",{staticClass:"text-center"},[o("button-with-loading",{staticStyle:{margin:"10px auto 1rem"},attrs:{text:"SIGN UP",width:"180",type:t.invalidPwd||t.invalidPwd2||""===t.model.fullName?"disable":"main",complete:t.isButtonLoadingComplete},on:{click:t.signup}}),o("div",{staticClass:"tk-text-center tk-font-color-main tk-cursor-pointer tk-font-weight-light",on:{click:function(e){return e.preventDefault(),t.notMe(e)}}},[t._v(" Already have an account? ")])],1)]:t._e()],2)])],1)])]),t.alert.isShow?o("alert",{attrs:{title:this.alert.title,content:this.alert.content,left:this.alert.buttons.left.title,right:this.alert.buttons.right.title},on:{onLeftTapped:this.alert.buttons.left.action,onRightTapped:this.alert.buttons.right.action}}):t._e()],1)},i=[],a=(o("9f1b"),o("3610"),o("eb5b"),o("c585"),o("f644"),o("3e83")),l=(o("6a61"),o("2e91")),s=o("fdc1"),r=o("a336"),c=o.n(r),d=(o("f5ef"),o("41dc")),u={components:{avatar:function(){return Promise.resolve().then(o.bind(null,"7a12"))},buttonWithLoading:function(){return o.e("chunk-194b20d5").then(o.bind(null,"6ea5"))},FadeTransition:d["b"],alert:function(){return o.e("chunk-2d0bdced").then(o.bind(null,"2e26"))}},data:function(){return{model:{fullName:"",email:"",password:"",password2:"",rememberMe:!1,userId:"",studioId:""},invalidEmail:!0,invalidPwd:!0,invalidPwd2:!0,email:"zw@gmail.com",step:1,passwordNotSame:!1,loading:!1,isButtonLoadingComplete:!1,failed:!1,failedMsg:"",alert:{isShow:!1,title:"",content:"",buttons:{left:{title:"",action:function(){}},right:{title:"",action:function(){}}}}}},mounted:function(){console.log("进入login页面")},computed:{getAllowedSignin:function(){return this.$store.state.isAllowedSignin}},watch:{failed:function(t){var e=this;t&&setTimeout((function(){e.failed=!1,e.failedMsg=""}),1e3)},getAllowedSignin:function(t,e){},model:{handler:function(t,e){this.loading||(this.$tools.isEmail(t.email)?(console.log("输入的是email"),this.invalidEmail=!1):(this.invalidEmail=!0,0===c()("#loginAccount").find(".invalid-feedback").length&&(this.invalidEmail=!1)),6===t.password.length?this.invalidPwd=!1:this.invalidPwd=!0,6===t.password2.length?(this.invalidPwd2=!1,t.password2===t.password?this.passwordNotSame=!1:this.passwordNotSame=!0):this.invalidPwd2=!0)},deep:!0}},methods:{getUserInfo:function(){var t=this;return new Promise(function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(o,n){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$firebase.firestore().collection("user").where("loginMethod","array-contains-any",[{method:1,account:t.model.email},{method:2,account:t.model.email},{method:3,account:t.model.email},{method:4,account:t.model.email}]).get();case 3:i=e.sent,a=[],i.forEach((function(t){a.push(t.data())})),console.log("获取到的用户列表：",a),a.length>0?(console.log("返回第一个用户信息：",a[0]),o(a[0])):(console.log("用户信息为空"),o(null)),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),n(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,o){return e.apply(this,arguments)}}())},getTeacherInfo:function(t){var e=this;return new Promise(function(){var o=Object(l["a"])(regeneratorRuntime.mark((function o(n,i){var a;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,e.$firebase.firestore().collection("teacher_info").doc(t).get();case 3:a=o.sent,console.log("获取到的教师信息: ",a),n(a.data()),o.next=11;break;case 8:o.prev=8,o.t0=o["catch"](0),i(o.t0);case 11:case"end":return o.stop()}}),o,null,[[0,8]])})));return function(t,e){return o.apply(this,arguments)}}())},next:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var o,n,i,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=t,o.invalidEmail||o.loading){e.next=32;break}return o.loading=!0,e.next=5,o.getUserInfo();case 5:if(n=e.sent,console.log("获取到的用户信息：",n),null===n){e.next=24;break}if(!o.$tools.isTeacher(n.roleIds)){e.next=20;break}return e.next=11,o.getTeacherInfo(n.userId);case 11:i=e.sent,console.log("获取到的教师信息: ",i),o.isButtonLoadingComplete=!0,o.step=2,o.model.fullName=n.name,o.model.userId=n.userId,o.model.studioId=i.studioId,e.next=22;break;case 20:o.isButtonLoadingComplete=!0,console.log("当前身份是学生,退出登录");case 22:e.next=31;break;case 24:return console.log("校验email是否正确"),e.next=27,s["a"].emailValidVerify(o.model.email);case 27:l=e.sent,console.log("当前email合法性: ",l),console.log("当前校验结果类型: ",Object(a["a"])(l)),l?(console.log("当前email合法"),o.isButtonLoadingComplete=!0,o.step=3,o.model.fullName=""):(console.log("Email 不合法: ",o.model.email),o.alert.title="Wrong email",o.alert.content="This email address \n("+o.model.email+") \ndoesn't exist or temporatily couldn't receive message.",o.alert.buttons.left.title="Go Back",o.alert.buttons.left.action=function(){o.alert.isShow=!1,o.isButtonLoadingComplete=!0},o.alert.buttons.right.title="Continue",o.alert.buttons.right.action=function(){o.alert.title="Continue?",o.alert.content="Are you sure to continue with this wrong email address \n("+o.model.email+")?",o.alert.buttons.left.title="Go Back",o.alert.buttons.right.title="Continue",o.alert.buttons.right.action=function(){o.isButtonLoadingComplete=!0,o.step=3,o.model.fullName="",o.alert.isShow=!1},o.alert.isShow=!0},o.alert.isShow=!0);case 31:o.isButtonLoadingComplete=!1;case 32:case"end":return e.stop()}}),e)})))()},notMe:function(){var t=this;t.model.fullName="",t.model.password="",t.model.password2="",t.invalidPwd=!0,t.invalidPwd2=!0,t.step=1},forgotPwd:function(){},login:function(){var t=this;t.$tools.isNull(t.model.email)||(t.loading=!0,t.$firebase.auth().signInWithEmailAndPassword(t.model.email,t.model.password).then((function(e){console.log("登陆成功：",e),t.loading=!1,t.isButtonLoadingComplete=!0})).catch((function(e){console.error("登陆失败：",e),t.isButtonLoadingComplete=!1}))),t.isButtonLoadingComplete=!1},loginWithFacebook:function(){console.log("ready to sign in with Facebook");var t=this;if(!t.loading){var e=t.$firebase,o=new e.auth.FacebookAuthProvider;t.signIn(o)}},loginWithGoogle:function(){console.log("ready to sign in with Google");var t=this;if(!t.loading){var e=t.$firebase,o=new e.auth.GoogleAuthProvider;t.signIn(o)}},loginWithApple:function(){console.log("ready to sign in with Apple");var t=this;if(!t.loading){var e=t.$firebase,o=new e.auth.OAuthProvider("apple.com");o.addScope("email"),o.addScope("name"),t.signIn(o)}},signIn:function(t){var e=this,o=e.$firebase;o.auth().signInWithPopup(t).then((function(t){console.log("login success");var e=t.credential.accessToken;localStorage.setItem("auth_token",e);var o=t.user;localStorage.setItem("auth_user",o)})).catch((function(t){console.error("login failed:",t)}))},signup:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var o,n,i,a,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=t,o.$tools.isNull(o.model.fullName)||o.$tools.isNull(o.model.password)||o.$tools.isNull(o.model.password2)||o.loading){e.next=16;break}return console.log("点击注册"),e.next=5,s["a"].emailValidVerify(t.model.email);case 5:return n=e.sent,n||t.$notify({message:"The email is wrong",type:"warning"}),console.log("校验结果: ",n),o.loading=!0,i=o.$firebase,a=i.functions().httpsCallable("teacherSignup"),e.next=13,a({email:o.model.email,password:o.model.password,fullName:o.model.fullName});case 13:l=e.sent,console.log("获取到的注册结果: ",l),l.data?0===l.data.code?t.login():console.log("sign up failed: ",l):console.error("sign up failed: ",l);case 16:case"end":return e.stop()}}),e)})))()}}},p=u,m=o("c701"),g=Object(m["a"])(p,n,i,!1,null,null,null);e["default"]=g.exports}}]);
//# sourceMappingURL=chunk-c8b5b0a6.70efc9ef.js.map