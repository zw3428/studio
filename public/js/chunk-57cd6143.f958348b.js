(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-57cd6143"],{"06cb":function(t,e,a){"use strict";e.__esModule=!0;var n=a("a593"),o=s(n),i=a("c865");function s(t){return t&&t.__esModule?t:{default:t}}var r=[],l="@@clickoutsideContext",c=void 0,u=0;function m(t,e,a){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!(a&&a.context&&n.target&&o.target)||t.contains(n.target)||t.contains(o.target)||t===n.target||a.context.popperElm&&(a.context.popperElm.contains(n.target)||a.context.popperElm.contains(o.target))||(e.expression&&t[l].methodName&&a.context[t[l].methodName]?a.context[t[l].methodName]():t[l].bindingFn&&t[l].bindingFn())}}!o.default.prototype.$isServer&&(0,i.on)(document,"mousedown",(function(t){return c=t})),!o.default.prototype.$isServer&&(0,i.on)(document,"mouseup",(function(t){r.forEach((function(e){return e[l].documentHandler(t,c)}))})),e.default={bind:function(t,e,a){r.push(t);var n=u++;t[l]={id:n,documentHandler:m(t,e,a),methodName:e.expression,bindingFn:e.value}},update:function(t,e,a){t[l].documentHandler=m(t,e,a),t[l].methodName=e.expression,t[l].bindingFn=e.value},unbind:function(t){for(var e=r.length,a=0;a<e;a++)if(r[a][l].id===t[l].id){r.splice(a,1);break}delete t[l]}}},6873:function(t,e,a){},"96c4":function(t,e,a){"use strict";a("ac48")},ac48:function(t,e,a){},e97a:function(t,e,a){"use strict";a.r(e);var n,o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("notifications"),a("base-header",{staticClass:"pb-6"},[a("div",{staticClass:"row align-items-center py-4"},[a("div",{staticClass:"col-lg-6 col-7"},[a("h6",{staticClass:"h2 text-white d-inline-block mb-0"},[t._v(" TuneKey Dynamic Link ")])]),a("div",{staticClass:"col-lg-6 col-5 text-right"},[a("base-button",{staticClass:"tk-font-color-main",attrs:{size:"sm",type:"neutral"},on:{click:function(e){return e.preventDefault(),t.logout(e)}}},[t._v("Logout")])],1)])]),a("div",{staticClass:"container-fluid mt--6"},[a("div",{staticClass:"card mb-4"},[t.isLoading?t._e():a("div",{staticClass:"card-header"},[a("div",{staticClass:"row align-items-center"},[a("div",{staticClass:"col-8"},[a("span",[t._v("From")]),a("flat-picker",{staticClass:"form-control form-control-muted tk-bg-color-gray-100 datepicker tk-layout-inline-block tk-px-width-px100 tk-px-margin-left-px8 tk-px-height-px36",attrs:{config:{allowInput:!0}},model:{value:t.from,callback:function(e){t.from=e},expression:"from"}}),a("span",[t._v(" - To")]),a("flat-picker",{staticClass:"form-control form-control-muted tk-bg-color-gray-100 datepicker tk-layout-inline-block tk-px-width-px100 tk-px-margin-left-px8 tk-px-height-px36",attrs:{config:{allowInput:!0}},model:{value:t.to,callback:function(e){t.to=e},expression:"to"}}),a("span",{staticClass:"btn btn-sm btn-neutral tk-px-margin-left-px16",class:{"tk-bg-color-gray-400 tk-border-color-gray-400 tk-font-color-white":!t.applyIsEnable,"tk-font-color-main":t.applyIsEnable},on:{click:function(e){return e.preventDefault(),t.initAnalytics(e)}}},[t._v("Apply")])],1),a("div",{staticClass:"col-4 text-right"},[a("span",{staticClass:"btn btn-sm btn-neutral tk-font-color-main",on:{click:function(e){e.preventDefault(),t.showModal=!0}}},[t._v("New Link")])]),a("div",{staticClass:"tk-dynamic-range-filter",staticStyle:{"margin-top":"10px","font-size":"14px"}},[a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":0===t.range},staticStyle:{color:"#8898aa"},on:{click:function(e){e.preventDefault(),t.range=0}}},[t._v("Total")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":1===t.range},staticStyle:{color:"#8898aa"},on:{click:function(e){e.preventDefault(),t.range=1}}},[t._v("Last 7 days")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":2===t.range},staticStyle:{color:"#8898aa"},on:{click:function(e){e.preventDefault(),t.range=2}}},[t._v("Last 30 days")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":3===t.range},staticStyle:{color:"#8898aa"},on:{click:function(e){e.preventDefault(),t.range=3}}},[t._v("This week")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":4===t.range},staticStyle:{color:"#8898aa"},on:{click:function(e){e.preventDefault(),t.range=4}}},[t._v("This month")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":5===t.range},staticStyle:{color:"#8898aa"},on:{click:function(e){e.preventDefault(),t.range=5}}},[t._v("This quater")]),a("span",{staticClass:"tk-px-margin-left-px16 tk-cursor-pointer",class:{"tk-font-color-main tk-font-weight-bold":6===t.range},staticStyle:{color:"#8898aa"},on:{click:function(e){e.preventDefault(),t.range=6}}},[t._v("This year")])])])]),a("div",{staticClass:"card-body",staticStyle:{height:"calc(100vh - 220px)"}},[t.isLoading?a("card-loading"):[a("spread-dynamic-link-inline-action-table",{attrs:{salesManParams:t.salesManParams,accessToken:t.accessToken,from:t.from,to:t.to},on:{analytic:t.analytic}})]],2)])]),a("modal",{attrs:{show:t.showModal},on:{"update:show":function(e){t.showModal=e}}},[a("template",{slot:"header"},[a("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[t._v("New Link")])]),a("div",{staticClass:"tk-popup-content",staticStyle:{"max-height":"60vh","overflow-y":"auto"}},[a("div",[a("span",[a("div",{staticClass:"form-group"},[a("label",{staticClass:"form-control-label"},[t._v("Name")]),a("div",{staticClass:"has-label"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"form-control form-control-muted tk-border-bottom tk-font-color-black1",attrs:{type:"text"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})])])]),a("div",[a("span",[a("div",{staticClass:"form-group"},[a("label",{staticClass:"form-control-label"},[t._v("Email")]),a("div",{staticClass:"has-label"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],staticClass:"form-control form-control-muted tk-border-bottom tk-font-color-black1",class:{"is-invalid":t.isInvalid},attrs:{type:"email"},domProps:{value:t.email},on:{blur:function(e){return e.preventDefault(),t.validationEmail(e)},input:function(e){e.target.composing||(t.email=e.target.value)}}})]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.isInvalid,expression:"isInvalid"}],staticClass:"invalid-feedback",staticStyle:{display:"block"}},[t._v(" The email is not correct. ")])])])]),a("span",[a("div",{staticClass:"form-group tk-px-margin-bottom-px0"},[a("label",{staticClass:"form-control-label"},[t._v("Free months")]),a("div",{staticClass:"has-label"},[a("el-select",{staticClass:"tk-select-border-none tk-border-bottom tk-select-bg-mute",model:{value:t.months.selected,callback:function(e){t.$set(t.months,"selected",e)},expression:"months.selected"}},t._l(t.months.options,(function(t,e){return a("el-option",{key:e,attrs:{label:t>0?t+"-MONTH-FREE":"FREE DOWNLOAD",value:t}})})),1)],1)])]),a("img",{staticStyle:{width:"calc(100% - 4rem)",display:"block",margin:"0 auto"},attrs:{src:"/img/coupon/coupon-"+t.months.selected+".png"}}),a("span",[a("div",{staticClass:"form-group card-wrapper tk-px-margin-bottom-px0"},[a("div",{staticClass:"card tk-px-margin-bottom-px16"},[a("div",{staticClass:"form-control",staticStyle:{height:"auto"}},[a("span",{staticClass:"tk-layout-inline-block tk-font-color-black1",staticStyle:{width:"calc(100% - 56px)"}},[t.expirationOpen?[a("span",[t._v("Expiration date")]),a("flat-picker",{staticClass:"form-control form-control-muted tk-bg-color-gray-100 datepicker tk-layout-inline-block tk-px-width-px100 tk-px-margin-left-px10 tk-px-height-px36",attrs:{config:{allowInput:!0}},model:{value:t.expiration,callback:function(e){t.expiration=e},expression:"expiration"}})]:a("span",[t._v("Expiration")])],2),a("base-switch",{staticClass:"mr-1 tk-layout-inline-block",attrs:{"on-text":"On","off-text":"Off",type:"main"},model:{value:t.expirationOpen,callback:function(e){t.expirationOpen=e},expression:"expirationOpen"}})],1)])])])])]),a("template",{slot:"footer"},[a("base-button",{staticClass:"tk-font-color-lightGray tk-border-none",attrs:{type:"secondary"},on:{click:function(e){e.preventDefault(),t.showModal=!1}}},[t._v("Close")]),a("button-with-loading",{staticStyle:{margin:"0 0 0 1rem"},attrs:{text:"Create",type:"main",complete:t.isButtonLoadingComplete},on:{start:t.addNewLink}})],1)],2)],1)},i=[],s=(a("82a8"),a("2a39"),a("2751"),a("96f8"),a("6a61"),a("9ad1")),r=a("2cb5"),l=(a("9102"),a("2984"),a("3aa8")),c=a.n(l),u=(a("086f"),a("ce6c")),m=a.n(u),d=(a("6873"),a("f5ef")),p=a("5e3a"),f={components:(n={CardLoading:function(){return a.e("chunk-271c3a43").then(a.bind(null,"1190"))},SpreadDynamicLinkInlineActionTable:function(){return Promise.all([a.e("chunk-386fd0ca"),a.e("chunk-894e4fa4"),a.e("chunk-0f9d75be"),a.e("chunk-10f3ed42"),a.e("chunk-8d470b7a")]).then(a.bind(null,"f150"))},flatPicker:function(){return a.e("chunk-10f3ed42").then(a.t.bind(null,"85db",7))}},Object(r["a"])(n,m.a.name,m.a),Object(r["a"])(n,c.a.name,c.a),Object(r["a"])(n,"buttonWithLoading",(function(){return a.e("chunk-5d7fb187").then(a.bind(null,"6ea5"))})),n),data:function(){return{from:"",to:"",range:1,adminUser:null,isLoading:!0,applyIsEnable:!1,dynamicLinksData:[],showModal:!1,isInvalid:!1,expirationOpen:!1,isButtonLoadingComplete:!1,expiration:"",email:"",name:"",months:{selected:3,options:[0,1,2,3,4,5,6]},originSalesManParams:[],salesManParams:[],salesMan:[],links:[],accessToken:"",json:{expireIn:1614556800,nonce:"jAHkKLOg2kGvnqUv",status:1,desc:"You are currently PRO now, enjoy TuneKey with unlimited access!",salesManId:"FHSpoJJKF",imageURL:"https://firebasestorage.googleapis.com/v0/b/tunekey-2019.appspot.com/o/images%2Fothers%2Fcoupon.png?alt=media&token=fd25342c-2377-48df-8cd1-3e2c225d6d9a",id:"JPSI82IK2",time:3}}},created:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,n,o,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,n=localStorage.getItem("adminUser"),e.next=4,p["a"].config.doc("salesAccount").get();case 4:if(o=e.sent,i=o.data().sales,a.initFromTo(),!a.$tools.isNull(n)){e.next=11;break}a.$router.push({name:"Login"}),e.next=23;break;case 11:a.adminUser=JSON.parse(n),s=0;case 13:if(!(s<i.length)){e.next=23;break}if(i[s].account!==a.adminUser.account||i[s].password!==a.adminUser.password){e.next=19;break}return a.getAccessToken(),e.abrupt("break",23);case 19:s===i.length-1&&a.$router.push({name:"Login"});case 20:s++,e.next=13;break;case 23:case"end":return e.stop()}}),e)})))()},watch:{expirationOpen:function(t,e){this.expiration=t?this.$tools.formatYYMMDD((new Date).getTime()):""},range:function(t,e){t>-1&&this.initFromTo()},from:function(t,e){if(this.applyIsEnable=!0,t.indexOf("-")>-1){var a=this.$tools.formatYYMMDD(new Date(t).getTime());new Date(a).getTime()>(new Date).getTime()&&(a=this.$tools.formatYYMMDD((new Date).getTime())),this.initRangeFromDay(),this.from=a}},to:function(t,e){if(this.applyIsEnable=!0,t.indexOf("-")>-1){var a=this.$tools.formatYYMMDD(new Date(t).getTime());new Date(a).getTime()>(new Date).getTime()&&(a=this.$tools.formatYYMMDD((new Date).getTime())),this.initRangeFromDay(),this.to=a}}},methods:{analytic:function(){this.isLoading=!1,console.log("分析完成")},initAnalytics:function(){var t=this;t.applyIsEnable&&(t.applyIsEnable=!1,d["a"].$emit("analytic"))},initRangeFromDay:function(){var t=this.$tools.getDaysByDateString(this.from,this.to);t<=7&&(this.to===this.$tools.formatYYMMDD((new Date).getTime())&&this.$tools.datesIsSameWeek(new Date(this.from).getTime(),new Date(this.to).getTime())?this.range=3:this.range=-1)},initDayFromRange:function(){var t,e=this,a=0,n=new Date,o=n.getDay(),i=e.$tools.formatYYMMDD(n.getTime());switch(e.range){case 0:var s=e.links.sort((function(t,e){return parseInt(t.createTime)-parseInt(e.createTime)}));t=e.$tools.formatYYMMDD(1e3*s[0].createTime),a=e.$tools.getDaysByDateString(t,e.to)-1;break;case 1:a=7;break;case 2:a=30;break;case 3:a=0===o?6:o-1;break;case 4:a=n.getDate()-1;break;case 5:t=e.$tools.getQuarterStartDate(),console.log("quarter start: ",t),a=parseInt((new Date(i).getTime()-new Date(t).getTime())/864e5);break;case 6:a=parseInt((new Date(i).getTime()-new Date(n.getFullYear()+"/1/1").getTime())/864e5);break}return a},initFromTo:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,n,o,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,e.next=3,a.initDayFromRange();case 3:n=e.sent,o=new Date,i=new Date,i.setDate(i.getDate()-n),a.to=a.$tools.formatYYMMDD(o.getTime()),a.from=a.$tools.formatYYMMDD(i.getTime());case 8:case"end":return e.stop()}}),e)})))()},getAccessToken:function(){var t=this,e=t.$firebase.functions().httpsCallable("getAccessToken");e().then((function(e){t.$tools.isNull(e.data.data)||(t.accessToken=e.data.data.token),t.getSalesMan()}))},getSalesMan:function(){var t=this;p["a"].salesMan.onSnapshot((function(e){if(e.empty)t.salesMan=[];else{var a=[];e.forEach((function(t){a.push(t.data())})),t.salesMan=a}console.log("listen salesMan: ",t.salesMan),t.getLinks()}))},getLinks:function(){var t=this;p["a"].salesManLinks.get().then((function(e){if(e.empty)t.links=[];else{var a=[];e.forEach((function(e){e.data().creator===t.adminUser.account&&a.push(e.data())})),t.links=a}t.getSalesManParams(),console.log("links: ",t.links)}))},getSalesManParams:function(){var t=this;p["a"].salesManParams.get().then((function(e){if(e.empty)t.salesManParams=[];else{var a=[];e.forEach((function(e){var n=t.$tools.objKeySort(e.data());n.email="",t.salesMan.some((function(t){t.salesManId==n.salesManId&&(n.email=t.email)})),t.links.some((function(t){t.id==n.id&&(n.link=t.link,n.createTime=t.createTime,a.push(n))}))})),t.salesManParams=a}console.log("data: ",t.salesManParams),t.originSalesManParams=t.salesManParams,t.isLoading=!1,t.initDataByRange()}))},initDataByRange:function(){},logout:function(){var t=this;localStorage.clear(),t.$router.push({name:"AdministrationLogin"})},addNewLink:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,n,o,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,n={expireIn:a.$tools.isNull(a.expiration)?0:parseInt(new Date(a.expiration).getTime()/1e3),nonce:a.$tools.getRandomString(16),status:1,desc:"You are currently PRO now, enjoy TuneKey with unlimited access!",salesManId:a.$tools.getRandomString(9),imageURL:"https://firebasestorage.googleapis.com/v0/b/tunekey-2019.appspot.com/o/images%2Fothers%2Fcoupon-"+a.months.selected+".png?alt=media&token=fd25342c-2377-48df-8cd1-3e2c225d6d9a",id:a.$tools.getRandomString(9),time:a.months.selected},n=t.$tools.objKeySort(n),o=t.$tools.getJsonKeyValueStr(n),o=o.substring(0,o.length-1),i=String(t.$md5(o)).toUpperCase(),e.next=8,a.$axios.post("https://firebasedynamiclinks.googleapis.com/v1/shortLinks?key=AIzaSyBdUyJmAAbAGEWq0hsbcidOUiaQU1aLxkM",{suffix:{option:"SHORT"},dynamicLinkInfo:{domainUriPrefix:"https://tunekey.app/link",link:"https://tunekey.app/redirect/i?u="+n.salesManId+"&c="+n.id+"&s="+i+"&t="+(new Date).getTime(),androidInfo:{androidPackageName:"com.spelist.tunekey",androidFallbackLink:"https://tunekey.app/download",androidMinPackageVersionCode:"1"},iosInfo:{iosBundleId:"com.spelist.tunekey",iosIpadBundleId:"tunekey",iosAppStoreId:"1479006791"},navigationInfo:{enableForcedRedirect:!1},socialMetaTagInfo:{socialTitle:"",socialDescription:"",socialImageLink:n.imageURL}}}).then(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.data.shortLink){t.next=14;break}return o=n,o.name=a.name,t.next=5,p["a"].salesManParams.doc(n.id).set(o);case 5:return t.next=7,p["a"].salesManLinks.doc(n.id).set({link:e.data.shortLink,id:n.id,createTime:parseInt((new Date).getTime()/1e3),creator:a.adminUser.account});case 7:return t.next=9,p["a"].salesMan.doc(n.salesManId).set({salesManId:n.salesManId,email:a.email});case 9:return t.next=11,p["a"].signUpViaLinkCount.doc(n.id).set({count:0,id:n.id});case 11:a.isButtonLoadingComplete=!0,a.showModal=!1,a.$notify({message:"Create Success!",type:"success"});case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){console.log(t)}));case 8:a.name="",a.email="",a.isButtonLoadingComplete=!1;case 11:case"end":return e.stop()}}),e)})))()},validationEmail:function(){var t=this;t.$tools.isNull(t.email)?t.isInvalid=!1:t.isInvalid=!t.$tools.isEmail(t.email)},getDynamicLinks:function(t){return new Promise((function(e,a){db.collection("sales_man_params").where("salesManId","==",t).get().then((function(t){if(t.empty)e([]);else{var a=[];t.forEach((function(t){a.push(t.data())})),e(a)}})).catch((function(t){console.error("Get [sales_man_params] failed, error: ",t),e([])}))}))},getSalesManId:function(t){return new Promise((function(e,a){db.collection("sales_man_record").where("userId","==",t).get().then((function(t){if(t.empty)e(null);else{var a=[];t.forEach((function(t){a.push(t.data())})),e(a[a.length-1])}})).catch((function(t){console.error("Get [sales_man_record] failed, error: ",t),e(null)}))}))}}},g=f,k=(a("96c4"),a("5d22")),h=Object(k["a"])(g,o,i,!1,null,"56d5b45d",null);e["default"]=h.exports}}]);
//# sourceMappingURL=chunk-57cd6143.f958348b.js.map